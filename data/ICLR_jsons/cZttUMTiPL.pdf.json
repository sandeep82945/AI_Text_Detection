{
    "abstractText": "We propose a new approach for propagating stable probability distributions through neural networks. Our method is based on local linearization, which we show to be an optimal approximation in terms of total variation distance for the ReLU non-linearity. This allows propagating Gaussian and Cauchy input uncertainties through neural networks to quantify their output uncertainties. To demonstrate the utility of propagating distributions, we apply the proposed method to predicting calibrated confidence intervals and selective prediction on out-of-distribution data. The results demonstrate a broad applicability of propagating distributions and show the advantages of our method over other approaches such as moment matching.1",
    "authors": [
        {
            "affiliations": [],
            "name": "Felix Petersen"
        },
        {
            "affiliations": [],
            "name": "Aashwin Mishra"
        },
        {
            "affiliations": [],
            "name": "Hilde Kuehne"
        },
        {
            "affiliations": [],
            "name": "Christian Borgelt"
        },
        {
            "affiliations": [],
            "name": "Oliver Deussen"
        },
        {
            "affiliations": [],
            "name": "Mikhail Yurochkin"
        }
    ],
    "id": "SP:4b554fefad5b437e9b7e6fb7009f62124b8cd581",
    "references": [
        {
            "authors": [
                "K. Yang",
                "X. Tang",
                "J. Li"
            ],
            "title": "Uncertainties in onboard algorithms for autonomous vehicles: Challenges, mitigation, and perspectives",
            "venue": "IEEE Transactions on Intelligent Transportation Systems, 2023.",
            "year": 2023
        },
        {
            "authors": [
                "D. Feng",
                "A. Harakeh",
                "S.L. Waslander",
                "K. Dietmayer"
            ],
            "title": "A review and comparative study on probabilistic object detection in autonomous driving",
            "venue": "IEEE Transactions on Intelligent Transportation Systems, vol. 23, no. 8, 2022.",
            "year": 2022
        },
        {
            "authors": [
                "A. Kendall",
                "Y. Gal"
            ],
            "title": "What uncertainties do we need in bayesian deep learning for computer vision?",
            "venue": "In Proc. Neural Information Processing Systems (NeurIPS),",
            "year": 2017
        },
        {
            "authors": [
                "M. Abdar",
                "F. Pourpanah",
                "S. Hussain"
            ],
            "title": "A review of uncertainty quantification in deep learning: Techniques, applications and challenges",
            "venue": "Information Fusion, vol. 76, 2021.",
            "year": 2021
        },
        {
            "authors": [
                "Y. Gal"
            ],
            "title": "Uncertainty in deep learning",
            "venue": "University of Cambridge, vol. 1, no. 3, 2016.",
            "year": 2016
        },
        {
            "authors": [
                "D. Hendrycks",
                "K. Gimpel"
            ],
            "title": "A baseline for detecting misclassified and out-of-distribution examples in neural networks",
            "venue": "Proceedings of International Conference on Learning Representations, 2017.",
            "year": 2017
        },
        {
            "authors": [
                "X. Zhou",
                "H. Liu",
                "F. Pourpanah",
                "T. Zeng",
                "X. Wang"
            ],
            "title": "A survey on epistemic (model) uncertainty in supervised learning: Recent advances and applications",
            "venue": "Neurocomputing, vol. 489, pp. 449\u2013465, 2022.",
            "year": 2022
        },
        {
            "authors": [
                "N. Tagasovska",
                "D. Lopez-Paz"
            ],
            "title": "Single-model uncertainties for deep learning",
            "venue": "Proc. Neural Information Processing Systems (NeurIPS), 2019.",
            "year": 2019
        },
        {
            "authors": [
                "R. Li",
                "C. Zhang",
                "H. Zhou",
                "C. Shi",
                "Y. Luo"
            ],
            "title": "Out-of-distribution identification: Let detector tell which i am not sure",
            "venue": "Proc. European Conference on Computer Vision (ECCV), S. Avidan, G. Brostow, M. Ciss\u00e9, G. M. Farinella, and T. Hassner, Eds., 2022.",
            "year": 2022
        },
        {
            "authors": [
                "A. Buchholz",
                "F. Wenzel",
                "S. Mandt"
            ],
            "title": "Quasi-Monte Carlo variational inference",
            "venue": "J. Dy and A. Krause, Eds., ser. Proceedings of Machine Learning Research, vol. 80, Stockholmsm\u00e4ssan, Stockholm Sweden: PMLR, Oct. 2018, pp. 668\u2013677.",
            "year": 2018
        },
        {
            "authors": [
                "Y. Sun",
                "A. Kortylewski",
                "A. Yuille"
            ],
            "title": "Amodal segmentation through out-of-task and outof-distribution generalization with a bayesian model",
            "venue": "Proc. International Conference on Computer Vision and Pattern Recognition (CVPR), 2022.",
            "year": 2022
        },
        {
            "authors": [
                "S. Ghosh",
                "F.M.D. Fave",
                "J. Yedidia"
            ],
            "title": "Assumed density filtering methods for learning bayesian neural networks",
            "venue": "Proceedings of the Thirtieth AAAI Conference on Artificial Intelligence, ser. AAAI\u201916, Phoenix, Arizona: AAAI Press, 2016, pp. 1589\u20131595.",
            "year": 2016
        },
        {
            "authors": [
                "C. Blundell",
                "J. Cornebise",
                "K. Kavukcuoglu",
                "D. Wierstra"
            ],
            "title": "Weight uncertainty in neural networks",
            "venue": "International Conference on Machine Learning (ICML), ML Research Press, 2015, pp. 1613\u20131622.",
            "year": 2015
        },
        {
            "authors": [
                "A. Graves"
            ],
            "title": "Practical variational inference for neural networks",
            "venue": "Proc. Neural Information Processing Systems (NeurIPS), 2011.",
            "year": 2011
        },
        {
            "authors": [
                "S. Munikoti",
                "D. Agarwal",
                "L. Das",
                "B. Natarajan"
            ],
            "title": "A general framework for quantifying aleatoric and epistemic uncertainty in graph neural networks",
            "venue": "Neurocomputing, vol. 521, pp. 1\u201310, 2023.",
            "year": 2023
        },
        {
            "authors": [
                "A. Loquercio",
                "M. Segu",
                "D. Scaramuzza"
            ],
            "title": "A general framework for uncertainty estimation in deep learning",
            "venue": "IEEE Robotics and Automation Letters, vol. 5, no. 2, pp. 3153\u20133160, 2020.",
            "year": 2020
        },
        {
            "authors": [
                "A. Shekhovtsov",
                "B. Flach"
            ],
            "title": "Feed-forward propagation in probabilistic neural networks with categorical and max layers",
            "venue": "International Conference on Learning Representations (ICLR), 2019. 10 Published as a conference paper at ICLR 2024",
            "year": 2019
        },
        {
            "authors": [
                "J.J. Thiagarajan",
                "I. Kim",
                "R. Anirudh",
                "P. Bremer"
            ],
            "title": "Understanding deep neural networks through input uncertainties",
            "venue": "IEEE International Conference on Acoustics, Speech and Signal Processing (ICASSP), 2019.",
            "year": 2019
        },
        {
            "authors": [
                "J. Gast",
                "S. Roth"
            ],
            "title": "Lightweight probabilistic deep networks",
            "venue": "Proc. International Conference on Computer Vision and Pattern Recognition (CVPR), 2018.",
            "year": 2018
        },
        {
            "authors": [
                "B. Lakshminarayanan",
                "A. Pritzel",
                "C. Blundell"
            ],
            "title": "Simple and scalable predictive uncertainty estimation using deep ensembles",
            "venue": "Proc. Neural Information Processing Systems (NeurIPS), 2017.",
            "year": 2017
        },
        {
            "authors": [
                "P. Si",
                "A. Bishop",
                "V. Kuleshov"
            ],
            "title": "Autoregressive quantile flows for predictive uncertainty estimation",
            "venue": "International Conference on Learning Representations (ICLR), 2022.",
            "year": 2022
        },
        {
            "authors": [
                "V. Kuleshov",
                "N. Fenner",
                "S. Ermon"
            ],
            "title": "Accurate uncertainties for deep learning using calibrated regression",
            "venue": "International Conference on Machine Learning (ICML), 2018.",
            "year": 2018
        },
        {
            "authors": [
                "E. Goan",
                "C. Fookes"
            ],
            "title": "Bayesian neural networks: An introduction and survey",
            "venue": "Case Studies in Applied Bayesian Data Science, Springer, 2020, pp. 45\u201387.",
            "year": 2020
        },
        {
            "authors": [
                "Y. LeCun",
                "C. Cortes",
                "C. Burges"
            ],
            "title": "Mnist handwritten digit database",
            "venue": "ATT Labs, vol. 2, 2010. [Online]. Available: http://yann.lecun.com/exdb/mnist.",
            "year": 2010
        },
        {
            "authors": [
                "G. Cohen",
                "S. Afshar",
                "J. Tapson",
                "A.V. Schaik"
            ],
            "title": "Emnist: Extending mnist to handwritten letters",
            "venue": "2017 International Joint Conference on Neural Networks (IJCNN), 2017.",
            "year": 2017
        },
        {
            "authors": [
                "H. Wang",
                "X. Shi",
                "D.-Y. Yeung"
            ],
            "title": "Natural-parameter networks: A class of probabilistic neural networks",
            "venue": "Proc. 30 Conf. on Neural Information Processing Systems (NIPS 2016, Barcelona, Spain), 2016, pp. 118\u2013126.",
            "year": 2016
        },
        {
            "authors": [
                "J. Jin",
                "A. Dundar",
                "E. Culutciello"
            ],
            "title": "Robust convolutional neural networks under adversarial noise",
            "venue": "Workshop Track Int. Conf. on Learning Representations (ICLR 2016, San Juan, Puerto Rico), 2016.",
            "year": 2016
        },
        {
            "authors": [
                "S. Wang",
                "C. Manning"
            ],
            "title": "Fast dropout training",
            "venue": "International Conference on Machine Learning (ICML), 2013.",
            "year": 2013
        },
        {
            "authors": [
                "J. Postels",
                "F. Ferroni",
                "H. Coskun",
                "N. Navab",
                "F. Tombari"
            ],
            "title": "Sampling-free epistemic uncertainty estimation using approximated variance propagation",
            "venue": "Proc. International Conference on Computer Vision (ICCV), 2019.",
            "year": 2019
        },
        {
            "authors": [
                "J.M. Hern\u00e1ndez-Lobato",
                "R. Adams"
            ],
            "title": "Probabilistic backpropagation for scalable learning of bayesian neural networks",
            "venue": "International Conference on Machine Learning (ICML), 2015.",
            "year": 2015
        },
        {
            "authors": [
                "A. Wu",
                "S. Nowozin",
                "E. Meeds",
                "R.E. Turner",
                "J.M. Hernandez-Lobato",
                "A.L. Gaunt"
            ],
            "title": "Deterministic variational inference for robust bayesian neural networks",
            "venue": "International Conference on Learning Representations (ICLR), 2019.",
            "year": 2019
        },
        {
            "authors": [
                "D.A. Nix",
                "A.S. Weigend"
            ],
            "title": "Estimating the mean and variance of the target probability distribution",
            "venue": "Proceedings of 1994 ieee international conference on neural networks (ICNN\u201994), IEEE, vol. 1, 1994, pp. 55\u201360.",
            "year": 1994
        },
        {
            "authors": [
                "B.J. Frey",
                "G.E. Hinton"
            ],
            "title": "Variational learning in nonlinear gaussian belief networks",
            "venue": "Neural Computation, vol. 11, pp. 193\u2013213, 1 1999.",
            "year": 1999
        },
        {
            "authors": [
                "F. Petersen",
                "C. Borgelt",
                "H. Kuehne",
                "O. Deussen"
            ],
            "title": "Deep Differentiable Logic Gate Networks",
            "venue": "Conference on Neural Information Processing Systems (NeurIPS), 2022.",
            "year": 2022
        },
        {
            "authors": [
                "Q. Berthet",
                "M. Blondel",
                "O. Teboul",
                "M. Cuturi",
                "J.-P. Vert",
                "F. Bach"
            ],
            "title": "Learning with Differentiable Perturbed Optimizers",
            "venue": "Proc. Neural Information Processing Systems (NeurIPS), 2020.",
            "year": 2020
        },
        {
            "authors": [
                "L. Montaut",
                "Q. Le Lidec",
                "A. Bambade",
                "V. Petrik",
                "J. Sivic",
                "J. Carpentier"
            ],
            "title": "Differentiable collision detection: A randomized smoothing approach",
            "venue": "IEEE International Conference on Robotics and Automation (ICRA), 2023.",
            "year": 2023
        },
        {
            "authors": [
                "F. Petersen"
            ],
            "title": "Learning with differentiable algorithms",
            "venue": "Ph.D. dissertation, Universit\u00e4t Konstanz, 2022.",
            "year": 2022
        },
        {
            "authors": [
                "F. Petersen",
                "C. Borgelt",
                "H. Kuehne",
                "O. Deussen"
            ],
            "title": "Monotonic differentiable sorting networks",
            "venue": "International Conference on Learning Representations (ICLR), 2022.",
            "year": 2022
        },
        {
            "authors": [
                "L. Stewart",
                "F.S. Bach",
                "F.L. L\u00f3pez",
                "Q. Berthet"
            ],
            "title": "Differentiable clustering with perturbed spanning forests",
            "venue": "Proc. Neural Information Processing Systems (NeurIPS), 2023. 11 Published as a conference paper at ICLR 2024",
            "year": 2023
        },
        {
            "authors": [
                "F. Petersen",
                "B. Goldluecke",
                "C. Borgelt",
                "O. Deussen"
            ],
            "title": "GenDR: A Generalized Differentiable Renderer",
            "venue": "Proc. International Conference on Computer Vision and Pattern Recognition (CVPR), 2022.",
            "year": 2022
        },
        {
            "authors": [
                "S. Elfwing",
                "E. Uchibe",
                "K. Doya"
            ],
            "title": "Sigmoid-weighted linear units for neural network function approximation in reinforcement learning. arxiv e-prints (2017)",
            "venue": "Neural Networks, vol. 107, pp. 3\u201311, 2018.",
            "year": 2018
        },
        {
            "authors": [
                "D. Hendrycks",
                "K. Gimpel"
            ],
            "title": "Gaussian error linear units (gelus)",
            "venue": "Computing Research Repository (CoRR) in arXiv, 2016.",
            "year": 2016
        },
        {
            "authors": [
                "K. He",
                "X. Zhang",
                "S. Ren",
                "J. Sun"
            ],
            "title": "Deep residual learning for image recognition",
            "venue": "Proceedings of the IEEE conference on computer vision and pattern recognition, 2016, pp. 770\u2013 778.",
            "year": 2016
        },
        {
            "authors": [
                "Y. Gal",
                "Z. Ghahramani"
            ],
            "title": "Dropout as a bayesian approximation: Representing model uncertainty in deep learning",
            "venue": "international conference on machine learning, PMLR, 2016, pp. 1050\u20131059.",
            "year": 2016
        },
        {
            "authors": [
                "Y. Geifman",
                "R. El-Yaniv"
            ],
            "title": "Selective classification for deep neural networks",
            "venue": "Proc. Neural Information Processing Systems (NeurIPS), 2017.",
            "year": 2017
        },
        {
            "authors": [
                "R. Balestriero",
                "S. Paris",
                "R.G. Baraniuk"
            ],
            "title": "Analytical Probability Distributions and EM- Learning for Deep Generative Networks",
            "venue": "Proc. Neural Information Processing Systems (NeurIPS), 2020.",
            "year": 2020
        },
        {
            "authors": [
                "N. Carlini",
                "A. Athalye",
                "N. Papernot"
            ],
            "title": "On evaluating adversarial robustness",
            "venue": "Computing Research Repository (CoRR) in arXiv, 2019.",
            "year": 2019
        },
        {
            "authors": [
                "A. Madry",
                "A. Makelov",
                "L. Schmidt",
                "D. Tsipras",
                "A. Vladu"
            ],
            "title": "Towards deep learning models resistant to adversarial attacks",
            "venue": "International Conference on Learning Representations (ICLR), 2018.",
            "year": 2018
        },
        {
            "authors": [
                "E. Wong",
                "Z. Kolter"
            ],
            "title": "Provable defenses against adversarial examples via the convex outer adversarial polytope",
            "venue": "International Conference on Machine Learning (ICML), 2018.",
            "year": 2018
        }
    ],
    "sections": [
        {
            "heading": "1 INTRODUCTION",
            "text": "Neural networks are part of various applications in our daily lives, including safety-critical domains such as health monitoring, driver assistance, or weather forecasting. As a result, it becomes important to not only improve the overall accuracy but also to quantify uncertainties in neural network decisions. A prominent example is autonomous driving [1], [2], where a neural network is not only supposed to detect and classify various objects like other cars or pedestrians on the road but also to know how certain it is about this decision and to allow, e.g., for human assistance for uncertain cases. Such prediction uncertainties can arise from different sources, e.g., model uncertainties and data uncertainties [3]\u2013[6]. These types of uncertainties have received considerable attention over the years. There is a line of work focusing on out-of-distribution (OOD) detection [7], [8], e.g., via orthogonal certificates [9] or via Bayesian neural networks [10]\u2013[15]. Another line of works focuses on quantifying data uncertainties, e.g., via uncertainty propagation [16]\u2013[20], ensembles [21], quantile regression [9], [22], post-hoc recalibration [23], or also via Bayesian neural networks [24]. Data uncertainties can primarily arise from two important sources: (i) input uncertainties, i.e., uncertainties arising in the observation of the input features, and (ii) output uncertainties, i.e., uncertainties arising in the observation of the ground truth labels. In this work, we primarily focus on quantifying how input uncertainties lead to prediction uncertainties, but also introduce an extension for quantifying input and output uncertainties jointly by propagating through a Probabilistic Neural Network (PNN). To address this task, the following work focuses on propagating distributions through neural networks. We consider the problem of evaluating f(x+ \u03f5), where f is a neural network, x is an input data point, and \u03f5 is a random noise variable (stable distribution, e.g., Gaussian). To this end, we approximate f(x + \u03f5) in a parametric distributional form, which is typically a location and a scale, e.g., for the Gaussian distribution, this corresponds to a mean and a covariance matrix. Evaluating the true output distribution Y (f(x+ \u03f5) \u223c Y ) exactly is intractable, so the goal is to find a close parametric approximation, ideally min\u00b5y,\u03a3y D ( N (\u00b5y,\u03a3y), Y ) for some distributional metric or divergence D.\nDue to the complexity of neural networks, specifically many non-linearities, it is intractable to compute the distribution of f(x+ \u03f5) analytically. A straightforward way to approximate location and scale, i.e., the mean and (co-)variances, \u00b5 and \u03a3, of f(x+ \u03f5) is to use a Monte Carlo (MC) estimate. However, this approach can often become computationally prohibitive as it requires evaluating a neural network f a large number of times. Additionally, the quality of the approximation for the covariances as well as the quality of their gradients deteriorates when the data is high-dimensional, e.g., for images. We, therefore, focus on analytical parametric approximations of f(x+ \u03f5).\n1The code is publicly available at github.com/Felix-Petersen/distprop.\nThis work proposes a technique, Stable Distribution Propagation (SDP), for propagating stable distributions, specifically Gaussian and Cauchy distributions, through ReLU-activated neural networks. Propagating the locations (e.g., means for the case of Gaussian) through a layer corresponds to the regular application of the layer or the neural network. For propagating scales (e.g., (co-)variances for the case of multivariate Gaussians), we can exactly propagate them through affine layers and further propose a local linearization for non-linear layers. The motivation for this is as follows: While it is intractable to find an optimal \u00b5y,\u03a3y , the problem can be separated into layer-wise problems using a divide-and-conquer strategy as, e.g., also done in moment matching approaches. While divide-andconquer works, looking at the problem from the perspective of multiple layers and deep networks again shows that any errors in individual layers caused by respective approximations accumulate exponentially. Therefore, the proposed method also considers a more robust approximation. Namely, we rely on the total variation (TV) to find the distribution that maintains as much probability mass at exactly correct locations as possible to reduce the overall propagation error. As the argmax-probability under respective distributions is intractable, we further propose a pairwise distribution loss function for classification tasks. Our evaluation for multiple-layer architectures confirms that this shows a better performance compared to marginal moment matching for multi-layer nets.\nOverall, the perspective of f(x+ \u03f5) allows assessing the sensitivity of the neural network for uncertainty quantification. In particular, it allows assessing the effects of uncertainties due to input measurement errors (Figure 1, left). Further, incorporating the sensitivity of a neural network during training can also enable selective prediction: because the method is able to regularize or minimize the output variance, the variance of predictions for observed data is\nminimized while the variance for predictions of unobserved data tends to be larger (Figure 1, right). Stable Distribution Propagation (SDP) provides an efficient technique for propagating distributions with covariances (or correlated scales) that performs (i) competitively to moment matching approximations (DVIA) at a fraction of the computational cost and (ii) superior to covariance-free marginal moment matching approaches. To our knowledge, our method is the first method to enable propagation of Cauchy distributions, or more generally the family of symmetric \u03b1-stable distributions. To empirically validate SDP, we (i) compare it to other distribution propagation approaches in a variety of settings covering total variation (TV) distance and Wasserstein distance; (ii) compare it to other uncertainty quantification methods on 8 UCI [25] regression tasks; and (iii) demonstrate the utility of Cauchy distribution propagation in selective prediction on MNIST [26] and EMNIST [27]."
        },
        {
            "heading": "2 RELATED WORK",
            "text": "Predictive uncertainties in deep learning can be decomposed into different components: model and data uncertainty. Model uncertainties arise due to model limitations such as variability in neural network weights and biases. Data uncertainties originate from incipient noise in the feature space that is propagated through the model as well as, separately, noise in the target space measurements. The focus of our investigation lies on data uncertainties. While analyzing the effects of input space uncertainties on predictive uncertainty, prior authors have focused on analytic approaches that avoid sampling. Such investigations address the approximate propagation of normal distributions at individual training samples through the network to model the network response to perturbed inputs [18], [20], [28], [29]. [28] propose Natural-Parameter networks, which allow using exponential-family distributions to model weights and neurons. Similarly, [30], [31] use uncertainty propagation to sampling-free approximate dropout, and [32] extend moment matching for Bayesian neural networks. These methods use (marginal) moment matching for propagating parametric probability distributions through neural networks, as we will subsequently discuss in greater detail. Deterministic Variational Inference Approximation (DVIA) [33] is an approximation to (full) moment matching of multi-variate Gaussian distributions for ReLU non-linearities. As an alternative, some authors have also focused on the output space uncertainty estimation, using approaches that yield both a point prediction along with the predictive uncertainty. [21] utilize PNNs [34] where the network outputs both the predicted mean and variance, which they augment via adversarial training and ensembling. Contrastingly, [9] learn conditional quantiles for estimating data uncertainties. We use several methods from this category as baselines in our example applications.\nOur proposed approach falls into the first category and is most similar to [20] and [18], but differs in how distributions are passed through non-linearities such as ReLUs. Previous work relies on (marginal) moment matching [35], also known as assumed density filtering. Moment matching is a technique where the first two moments of a distribution, such as the output distribution of ReLU (i.e., the mean and variance) are computed and used as parameters for a Gaussian distribution to approximate the true distribution. As it is otherwise usually intractable, moment matching techniques match the distribution to a marginal multivariate Gaussian (i.e., with a diagonal covariance matrix) at each layer. Accordingly, we refer to it as marginal moment matching. SDP propagates stable distributions by an approximation that minimizes the total variation (TV) distance for the ReLU activation function. We find that this approximation is faster to compute, better with respect to TV and Wasserstein distances, and allows for efficient non-marginal propagation. Further, as it does not rely on moment matching, it can also be used to propagate Cauchy distributions for which the moments are not finitely defined. Another advantage of SDP is that it can be applied to pre-trained models. In contrast, moment matching changes the mean, causing deviations from regular (point) propagation through the network, leading to poor predictions when applied to pre-trained networks. Beyond UQ, SDP was inspired by propagating distributions through logic gate networks [36], optimizers [37], simulators [38], and algorithms [39], e.g., for sorting [40], clustering [41], and rendering [42]."
        },
        {
            "heading": "3 STABLE DISTRIBUTION PROPAGATION",
            "text": "Stable distributions are families of parametric distributions that are closed under addition of random variables (RV) and constants, as well as multiplication by positive constants. To give a concrete example, the sum of two Gaussian distributions is a Gaussian distribution. For Gaussian and Cauchy distributions, the reproductive property also holds under subtraction by RVs and multiplication by negative constants. Therefore, we will focus on Gaussian and Cauchy distributions; however, in Supplementary Material A.2, we provide special consideration of general \u03b1-stable distributions for positive-weight networks as well as uncertainty bounds for real-weight networks. We emphasize that, throughout this work (with exclusion of SM A.2), we do not put any restrictions on network weights. For propagating stable distributions, particularly Gaussian and Cauchy distributions, through neural networks, we consider affine transformations and non-linearities, such as ReLU, separately. For the first case, affine transformations, an exact computation of the parametric output distribution is possible due to the reproductive property of Gaussian and Cauchy distributions. For the second case, non-linearities, we propose to use local linearization and (i) show that, for individual ReLUs, this approximation minimizes the TV distance, and (ii) empirically find that, also in more general settings, it improves over substantially more expensive approximations wrt. both Wasserstein and TV."
        },
        {
            "heading": "3.1 AFFINE TRANSFORMATIONS",
            "text": "The outputs of fully connected layers as well as convolutional layers are affine transformations of their inputs. We use the notation y = xA\u22a4+ b where A \u2208 Rm\u00d7n is the weight matrix and b \u2208 R1\u00d7m is the bias vector with n,m \u2208 N+. We assume that any covariance matrix \u03a3 may be positive semi-definite (PSD) and that scales may be \u2265 0. These are fairly standard assumptions, and we refer to Dirac\u2019s \u03b4-distribution for scales of 0. As convolutional layers can be expressed as fully connected layers, we discuss them in greater detail in Supplementary Material A.3 and discuss only fully connected layers (aka. affine / linear layers) here. We remark that AvgPool, BatchNorm, etc. are also affine and thus need no special treatment. Given a multivariate Gaussian distribution X \u223c N (\u00b5,\u03a3) with location \u00b5 \u2208 R1\u00d7n and PSD scale \u03a3 \u2208 Rn\u00d7n, X can be transformed by a fully connected layer via \u00b5 7\u2192 \u00b5A\u22a4 + b and \u03a3 7\u2192 A\u03a3A\u22a4. Given a multivariate marginal Gaussian distribution X \u223c N (\u00b5,diag(\u03c32)) with \u00b5 \u2208 R1\u00d7n, \u03c3\u22650 \u2208 R1\u00d7n, the marginal Gaussian distribution of the transformation of X can be expressed via \u00b5 7\u2192 \u00b5A\u22a4 + b and \u03c32 7\u2192 \u03c32(A2)\u22a4 where \u00b7 2 denotes the element-wise square. Given a multivariate marginal Cauchy distribution X\u223cC(x0,diag(\u03b32)) with x0\u2208R1\u00d7n, \u03b3\u2208R1\u00d7n\u22650 , the marginal Cauchy distribution of the transformation of X is x0 7\u2192x0A\u22a4+ b and \u03b3 7\u2192\u03b3 Abs(A)\u22a4. Notably, in all cases, the location \u00b5/x0 coincides with the values propagated in conventional network layers, which will also generally hold throughout this work. This allows applying this method directly to pre-trained neural networks. In Section 3.3, we discuss how to efficiently and effectively compute the output scales \u03a3 / \u03b3. Now, we cover propagating distributions through non-linearities.\nMoment Matching SDP (ours)"
        },
        {
            "heading": "3.2 NON-LINEAR TRANSFORMATIONS",
            "text": "To handle non-linearities, we utilize local linearization and transform the locations and scales as:\n(\u00b5, \u03c3) 7\u2192 (fa(\u00b5), |f \u2032a(\u00b5)| \u00b7 \u03c3) , (\u00b5,\u03a3) 7\u2192 (fa(\u00b5), f \u2032a(\u00b5)\u03a3 f \u2032a(\u00b5)\u22a4) . (1) As ReLU is the most common non-linearity for neural networks, we give it our primary consideration. Using local linearization, the proposed approximation for transforming distributions with ReLUs is\nReLU : (\u00b5, \u03c3) 7\u2192 { (\u00b5, \u03c3) \u00b5 \u2265 0 (0, 0) otherwise\n(2)\nfor distributions parameterized via \u00b5 and \u03c3. In fact, for stable distributions, this approximation is optimal wrt. TV. Recall that the TV between the true distribution Q and an approximation P is\nTV (P ,Q) = sup A \u2223\u2223\u2223\u2223\u222b A (p\u2212 q) d\u03bd \u2223\u2223\u2223\u2223 = 12 \u222b |p\u2212 q| d\u03bd . (3)\nTV is a vertical distance, which is closely related to the KL divergence, i.e., it measures for each point how densities or probability masses deviate. Due to the nature of the ReLU, the KL divergence is undefined (because Q and P have different support.) In the experiments in Section 3.4, we also consider approximation quality wrt. the Wasserstein distance, i.e., a horizontal probability distance. In the following, we formalize that the approximation of a ReLU non-linearity minimizes the TV. Recall that when parameterizing a Gaussian or Cauchy distribution with (0, 0), we are referring to Dirac\u2019s \u03b4-distribution. The transformed distributions and their propagations are illustrated in Figure 2. Theorem 1. Local linearization provides the optimal Gaussian approximation of a univariate Gaussian distribution transformed by a ReLU non-linearity with respect to the total variation:\nargmin (\u00b5\u0303,\u03c3\u0303) TV (P ,Q) = { (\u00b5, \u03c3) \u00b5 \u2265 0 (0, 0) otherwise\n(4)\nwhere P = N (\u00b5\u0303, \u03c3\u03032), Q = ReLU(N (\u00b5, \u03c32))\nProof Sketch. Recall that by using a stable parametric distribution we can either have a density (i.e., no mass at any point) or a point mass at a single point. Whenever we have a positive location \u00b5 \u2265 0 (as in Figures 2 (b) and (d)), SDP exactly covers the true probability distribution except for the point mass at 0, which cannot be covered without choosing a point mass. Any deviation from this, like, e.g., the moment matching result leads to an increase in the TV. Whenever we have a negative location \u00b5 < 0 (as in Figures 2 (a) and (c)), SDP chooses to use a point mass at 0; any other approximation has a larger TV because more than 0.5 of the mass lies at point 0 in the true distribution.\nThe proofs are deferred to Supplementary Material A.1.\nCorollary 2. Theorem 1 also applies to Cauchy distributions parameterized via x0, \u03b3 instead of \u00b5, \u03c3.\nAfter covering the ReLU non-linearity in detail, we remark that we empirically also consider a range of other non-linearities including Logistic Sigmoid, SiLU, GELU, and Leaky-ReLU in SM B.1.\nEquipped with the proposed technique for propagation, it is natural to assume that SDP may be computationally expensive; however, in the following section, we show how SDP can actually be very efficiently computed, even when propagating covariances."
        },
        {
            "heading": "3.3 COMPUTING THE SCALE PARAMETERS",
            "text": "For SDP, the location parameter of the output is simply the function value evaluation at the location of the input distribution. Therefore, we only need to give special consideration to the computation of the scale parameters. We provide pseudo-code and PyTorch implementations of SDP in SM D.\nIf we consider marginal Gaussian and marginal Cauchy distribution propagation, we need to carry one scale parameter for each location parameter through the network, i.e., each layer computes location and scales, which makes it around two times as expensive as regular propagation of a single point value. When comparing to marginal moment matching, marginal moment matching has a similar computational cost except for non-linear transformations being slightly more expensive if a respective marginal moment matching approximation exists. We remark that, for marginal moment matching, the locations (means) deviate from regular function evaluations and require the means to be matched.\nAn inherent limitation of any marginal propagation approach is that correlations between components of the random variables are discarded at each layer. For Gaussian distributions, this can lead to a layer-wise decay of scales, as illustrated, e.g., in the SM in Table 28 and Figure 10.\nIf we consider the non-marginal distribution case, we need to compute a scale matrix (e.g., the covariance matrix of a Gaussian). If we had to compute the scale matrix between any two layers of a neural network, it would become prohibitively expensive as the scale matrix for a layer with n neurons has a size of n\u00d7 n. Because we are using a local linearization, we can compute the output scale matrix \u03a3y of an l layer network f(x) = fl(fl\u22121(\u00b7 \u00b7 \u00b7 f1(x) \u00b7 \u00b7 \u00b7 )) as\n\u03a3y = J(fl) \u00b7 J(fl\u22121) \u00b7 \u00b7 \u00b7 J(f1) \u00b7\u03a3 \u00b7 J(f1)\u22a4 \u00b7 \u00b7 \u00b7 J(fl\u22121)\u22a4 \u00b7 J(fl)\u22a4 (5) where J(fl) denotes the Jacobian of the lth layer. Via the chain rule, we can simplify the expression to\n\u03a3y = J(f) \u00b7\u03a3 \u00b7 J(f)\u22a4 , (6) which means that we can, without approximation, compute the scale matrix based on J(f) (the Jacobian of the network.) Computing the Jacobian is relatively efficient at a cost of around min(kin , kout) network evaluations where kin and kout correspond to the input and output dimensions, respectively. Exactly computing the moments for a full moment matching technique is intractable, even for very small networks. [33] proposed the approximate moment matching technique DVIA, which makes this idea tractable via approximation; however, their approach requires instantiating and propagating an n\u00d7 n matrix through each layer, making DVIA expensive, particularly for large networks. Finally, we would like to discuss how to evaluate the marginal Cauchy SDP without discarding any correlations within the propagation through the network. For this case, we can evaluate the Jacobian J(f) and derive the marginal scale of the output Cauchy distribution as \u03b3y = \u03b3 \u00b7Abs(J(f))\u22a4."
        },
        {
            "heading": "3.4 EXPERIMENTAL EVALUATION OF SDP",
            "text": "To experimentally validate the performance of our approximation in the multi-dimensional multi-layer case, we train a set of neural networks with ReLU non-linearities trained with softmax cross-entropy on the Iris data set. We use Iris as it has small input and output dimensions, allowing us to use Monte Carlo as a feasible and accurate oracle estimator of the truth, and because we also compare to methods that would be too expensive for larger models. We compute the MC oracle with 106 samples and evaluate it wrt. the intersection of probabilities / TV in Table 1 and wrt. the Wasserstein distance in Table 2. Each result is averaged over propagations through 10 independent models.\nIn Table 1, we can observe that SDP performs slightly superior to the more expensive DVIA approach. As another baseline, we estimate the Gaussian output distribution via propagating k samples from the\ninput distribution through the network, referred to as \u201cMC Estimate\u201d in Tab. 1. We can observe that SDP consistently outperforms MC estimation via 100 samples. Finally, when comparing marginal SDP to marginal moment matching, we can see that for input \u03c3 = 0.1 marginal moment matching has an advantage while marginal SDP performs better in the other cases. In Supplementary Material B.1, we present results for additional architectures (Tab. 7\u201314), numbers of MC samples (Tab. 15\u201318) and non-linearities, including evaluations for Leaky-ReLU (Tab. 23\u201326), logistic sigmoid activations (Tab. 27), SiLU activations [44] (Tab. 29\u201332), and GELU activations [45] (Tables 33\u201336).\nTable 2: Evaluation of the accuracy of Gaussian SDP for a network with 4 ReLU layers (Iris). Here, we measure the W1 Wasserstein distance between the ground truth distribution and our prediction, simulated via sets of 30 000 samples each. (Smaller is better.)\n\u03c3 SDP DVIA mar. Moment M.(\u2020) 0.01 0.0092 \u00b1 0.0060 0.0092 \u00b1 0.0059 0.1924\u00b1 0.1327 0.1 0.1480 \u00b1 0.1574 0.1520\u00b1 0.1805 2.0809\u00b1 1.2755 1 7.7325\u00b1 5.1254 7.5794 \u00b1 4.4295 20.9889\u00b1 7.7142\nFigure 3: Plot of the log. of the W1 distance between the true distribution ReLU(X) (i.e., the distribution after a single ReLU) and SDP (blue) as well as marginal moment matching (orange).\n\u22120.4 \u22120.2 0 0.2 0.4\n\u22122\n\u22123\n\u22124\n\u22125\n\u22126\nlo g 1\n0( W\n1)\ninput \u00b5\nStable DP (ours) Moment Matching In Table 2, we compare the Wasserstein distances for SDP to DVIA and marginal moment matching. We observe that SDP is consistently competitive with the best results from DVIA, despite the substantially higher complexity of the latter.\nIn Fig. 3, we show the W1 distance between the true distribution ReLU(X) and SDP, as well as marginal moment matching. Here, X \u223c N (\u00b5, \u03c3 = 0.1); and \u00b5 is given on the horizontal axis of the plot. We can see that SDP has smaller W1 distances except for the area very close to \u00b5 = 0. Additional architectures can be found in SM B.1 (Tab. 19\u201322). In Tab. 3, we evaluate SDP for a CIFAR-10 ResNet-18 [46] model on 500 images. We consider the TV between predicted distributions (distributions over classes) under Gaussian input noise on images. The ground truth is based on sets of 5 000 samples. We observe that SDP reduces the TV, illustrating the scalability of SDP to deeper and larger networks."
        },
        {
            "heading": "3.5 LEARNING WITH STABLE DISTRIBUTION PROPAGATION",
            "text": "With the ability to propagate distributions through neural networks, the next step is to also use SDP for training. As the output of a neural network is a (multivariate) Gaussian or Cauchy distribution, the goal is to incorporate the covariances corresponding to the neural network\u2019s output into the loss.\nFor regression tasks, we minimize the negative log-likelihood, which is readily available and easy to optimize for Gaussian and Cauchy distributions including the multivariate (non-marginal) case. This enables the consideration of correlations between different output dimensions in the likelihood.\nThe more difficult case is classification with many classes. This is because the exact probability of a score among n \u226b 2 scores being the maximum is intractable. Conventionally, in uncertainty agnostic training, this is resolved by assuming a Gumbel uncertainty in the output space, leading to the well-known softmax function / distribution. In particular, softmax corresponds to the probability of the argmax under isotropic Gumbel noise. However, for other distributions we are not aware of any closed-form solutions; for Gaussian distributions, the probability of argmax becomes hopelessly intractable, and finding closed-form correspondences may be generally considered an open problem. Previous work has proposed using marginal moment matching of softmax [20], Dirichlet outputs [20], and an approximation to the (n\u2212 1)-variate logistic distribution [18]. Instead of finding a surrogate that incorporates the marginal variances of the prediction, we propose to use the exact pair-wise probabilities for classification. To this end, we propose computing the pairwise probability of correct classification among all possible pairs in a one-vs-one setting, i.e., the true class score is compared to all false classes\u2019 scores and all n\u2212 1 losses are averaged. This allows incorporating not only the scales but also the scale matrix (i.e., correlations) of a prediction.\nThe probability of pairwise correct classification for two RVs, X (true class score) and Y (false class score), is P(X > Y ) = P(X \u2212 Y > 0) = \u222b\u221e 0 PDFX\u2212Y (x) dx = CDFY\u2212X(0) . (7)\nFor a multivariate Gaussian distribution (X,Y ) \u223c N ((\u00b5X , \u00b5Y ), \u03a3) with covariance matrix \u03a3.\nP(X > Y ) = 12\n( 1 + erf ( \u00b5X\u2212\u00b5Y\u221a\n2(\u03c32XX+\u03c3 2 Y Y \u22122\u03c3XY )\n)) (8)\nFor Cauchy distributions X \u223c C(xX , \u03b3X) and Y \u223c C(xY , \u03b3Y ). P(X > Y ) = 1\u03c0 ( arctan ( xX\u2212xY \u03b3X+\u03b3Y )) + 12 (9)\nWe refer to these losses as the Pairwise Distribution Losses for Gaussian resp. Cauchy distributions."
        },
        {
            "heading": "4 ADDITIONAL EXPERIMENTS",
            "text": "In this section, we evaluate the proposed method and loss functions on different tasks for distribution propagation. First, we investigate how well our method quantifies uncertainty on UCI [25] regression tasks. Second, we test how well our method can estimate model uncertainty for detection of out-ofdistribution test data. In SM B.4, we investigate robustness against Gaussian and adversarial noise."
        },
        {
            "heading": "4.1 UNCERTAINTY QUANTIFICATION ON UCI DATA SETS",
            "text": "To evaluate uncertainty quantification on UCI regression tasks, we consider predicting calibrated intervals. We follow the experimental setting of Tagasovska et al. [9] and compare the proposed method to their Conditional Quantiles (SQR) method as well as PNNs, which was their best reported baseline. As SDP and PNNs are not mutually exclusive but are instead complementary, we consider applying our method to PNNs, i.e., we propagate distributions through the location component of the PNN and consider the uncertainty of the summation of both sources of uncertainty. Recall that SDP quantifies uncertainties arising from the input space and PNNs predict uncertainties in the output space, so we expect them to work well together at quantifying both types of data uncertainties. Details of the formulation for applying SDP to Gaussian PNNs can be found in Supplementary Material C.3.\nWe use the same model architecture, hyper-parameters, and evaluation metrics as [9] for all three methods. The evaluation metrics are Prediction Interval Coverage Probability (PICP), i.e., the fraction of test data points falling into the predicted intervals, and the Mean Prediction Interval Width (MPIW), i.e., the average width of the prediction intervals. In Tab. 4, following [9], we report the test PICP\nand MPIW of those models where the validation PICP lies between 92.5% and 97.5% using the evaluation code provided by Tagasovska et al. [9]. The goal is to achieve a narrow interval (small MPIW) while keeping the optimal test PICP of 95%. As we quantify data uncertainty (and not model uncertainty) we note that the best deep ensemble [21] collapses to a single PNN; MC dropout [47] and Bayesian neural networks would focus on model and not on data uncertainty, see [9].\nWe can observe that SDP by itself performs competitively; compared to the baseline methods, which achieve predicting the narrowest intervals only on one of the data sets, SDP predicts the narrowest intervals on 3 data sets. Further, when applying SDP to PNNs, we improve over this result by achieving the narrowest intervals on 5 data sets. Notably, SDP + PNN does not only have the narrowest intervals but also the best overall prediction interval coverage. In each case, the best result (including on-par results) is either achieved by SDP or SDP + PNN and a general trend is that SDP + PNN leads to better calibrated prediction interval coverage. On \u2018boston\u2019, the stochastic MC Estimate approach with k = 100 propagations leads to the narrowest and best calibrated intervals; however, this result for MC Estimate comes at the substantially greater computational cost."
        },
        {
            "heading": "4.2 OUT-OF-DISTRIBUTION SELECTIVE PREDICTION ON MNIST AND EMNIST",
            "text": "Selective prediction [48] is a formulation where instead of only predicting a class, a neural network can also abstain from a prediction if it is not certain. We benchmark selective prediction on MNIST [26] and use EMNIST letters [27] as out-of-distribution data. EMNIST letters is a data set that contains letters from A to Z in the same format as MNIST. We train a neural network on the MNIST training data set and then combine the MNIST test data set (10 000 images) with 10 000 images from the EMNIST letter data set. This gives us a test data set of 20 000 images, 50% of which are out-of-distribution samples and for which the model should abstain from prediction. We provide risk-coverage plots [48] of the selective prediction in Fig. 4 as well as the respective scores in Tab. 5. Risk-coverage plots report the empirical risk (i.e., the error) for each degree of coverage \u03b1. That is, we select the \u03b1 most certain predictions and report the error. This corresponds to a setting, where a predictor can abstain from prediction in 1\u2212\u03b1 of the cases. We use risk-coverage area-under-the-curve\n(AUC) to quantify the overall selective prediction performance. Smaller AUC implies that the network is more accurate on in-distribution test data while abstaining from making a wrong prediction on OOD examples. In this experiment, no correct predictions on OOD data are possible because the classifier can only predict numbers while the OOD data comprises letters.\nIn the first setting, in Figure 4 (a) and Table 5 (a), we train a neural network with conventional softmax cross-entropy to receive an existing off-the-shelf network. We compare five methods to compute certainty scores. First, we use the softmax entropy of the prediction, and apply Orthonormal Certificates from Tagasovska et al. [9]. Second, we propagate a distribution with \u03c3 = 0.1 through the network to obtain the covariances. Using these covariances, we use our pairwise Gaussian probabilities as well as the categorical probabilities of the Dirichlet outputs [20] to compute the entropies of the predictions. In the second setting, in Figure 4 (b) and Table 5 (b), we train the neural network using uncertainty propagation with the PD Gaussian loss as well as using marginal moment matching propagation and Dirichlet outputs [20]. We find that training with an uncertainty-aware training objective (pairwise Gaussian and Cauchy losses and Dirichlet outputs) improves the outof-distribution detection in general. Further, we find that the pairwise Cauchy scores achieve the best out-of-distribution detection on a pre-trained model. Orthonormal certificates (OC) estimate null-space of data in the latent space to detect out-of-distribution examples. Digits and letters may share a similar null-space, making OC not as effective. The Dirichlet distribution does not perform well on a pretrained model because it is not designed for this scenario but instead designed to work in accordance with moment matching. We also observe that, for a model trained with Dirichlet outputs and marginal moment matching uncertainty propagation, selective prediction confidence scores of pairwise Gaussian and pairwise Cauchy offer an improvement in comparison to the Dirichlet output-based scores. This suggests that pairwise Cauchy scores are beneficial across various training approaches. The overall best accuracy (18.3% AUC) is achieved by training with an uncertaintyaware objective and evaluating using pairwise Cauchy. We also report RCAUC of a perfect predictor, i.e., one that always abstains on out-of-distribution data and always predicts correctly in-distribution.\n4.3 RUNTIME ANALYSIS\nIn Table 6, we analyze the runtime for propagating distributions. While marginal distribution propagation causes only a slight overhead for small models, propagating distributions with full scale matrices is more expensive. Marginal moment matching (i.e., without scale matrix) is slightly more expensive than marginal SDP, as it requires evaluating additional\n(scalar) functions at the non-linearities. The complexity factor (i.e., the factor of the cost of propagating a single point through the neural network) is linear in the minimum of input and output dimension for SDP, while it is constant for marginal propagation. As a reference, the exact propagation of the distributions (and not a parametric approximation as in this work) has an exponential runtime factor in the number of neurons [49]. The complexity factor of DVIA [33] is linear in the number of neurons in the largest layer, e.g., for the MNIST experiments in Section B.4, the computational time of a single forward pass with DVIA would be over 12 500 regular forward passes, which makes experiments exceeding Table 1 infeasible. See SM C for additional implementation details."
        },
        {
            "heading": "5 CONCLUSION",
            "text": "The application of deep learning across safety and reliability critical tasks emphasizes the need for reliable quantification of predictive uncertainties in deep learning. A major source of such uncertainty is data uncertainty, arising due to errors and limitations in the features and target measurements. In this work, we introduced SDP, an approach for propagating stable distributions through neural networks in a sampling-free and analytical manner. Our approach is superior to prior moment matching approaches in terms of accuracy and computational cost, while also enabling the propagation of a more diverse set of input distributions. Using SDP, we predict how input uncertainties lead to prediction uncertainties, and also introduced an extension for quantifying input and output uncertainties jointly. We demonstrated the utility of these new approaches across tasks involving prediction of calibrated confidence intervals and selective prediction of OOD data while comparing to other UQ approaches."
        },
        {
            "heading": "ACKNOWLEDGMENTS",
            "text": "This work was supported by the Goethe Center for Scientific Computing (G-CSC) at Goethe University Frankfurt, the IBM-MIT Watson AI Lab, the DFG in the Cluster of Excellence EXC 2117 \u201cCentre for the Advanced Study of Collective Behaviour\u201d (Project-ID 390829875), the Land Salzburg within the WISS 2025 project IDA-Lab (20102-F1901166-KZP and 20204-WISS/225/197-2019), and the U.S. DOE Contract No. DE-AC02-76SF00515."
        },
        {
            "heading": "Supplementary Material for",
            "text": ""
        },
        {
            "heading": "Uncertainty Quantification via Stable Distribution Propagation",
            "text": ""
        },
        {
            "heading": "Table of Contents",
            "text": ""
        },
        {
            "heading": "A Additional Discussions and Proofs 13",
            "text": "A.1 Theorem 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13 A.2 Considerations for \u03b1-Stable Distributions . . . . . . . . . . . . . . . . . . . . . 14 A.3 Convolutions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14"
        },
        {
            "heading": "B Additional Experiments 15",
            "text": "B.1 Propagating Gaussian Distributions . . . . . . . . . . . . . . . . . . . . . . . . 15 B.2 Additional Standard Deviations for Results in the Main Paper . . . . . . . . . . 21 B.3 Additional Results for UCI UQ with MC Estimate . . . . . . . . . . . . . . . . 22 B.4 Gaussian and Adversarial Noise Robustness . . . . . . . . . . . . . . . . . . . 22 B.5 Marginal Propagation Visualization . . . . . . . . . . . . . . . . . . . . . . . . 25\nC Implementation Details 25 C.1 Simulation of Propagating Normal Distributions . . . . . . . . . . . . . . . . . 25 C.2 UCI Uncertainty Quantification . . . . . . . . . . . . . . . . . . . . . . . . . . 25 C.3 Applying SDP to PNNs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25 C.4 Selective Prediction on Out-of-Distribution Data . . . . . . . . . . . . . . . . . 26 C.5 Gaussian and Adversarial Noise Robustness . . . . . . . . . . . . . . . . . . . 26 C.6 Propagating without Covariances . . . . . . . . . . . . . . . . . . . . . . . . . 26 C.7 Evaluation Metrics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26 C.8 MaxPool . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26\nD Implementations of SDP: Pseudo-Code and PyTorch 26"
        },
        {
            "heading": "A ADDITIONAL DISCUSSIONS AND PROOFS",
            "text": ""
        },
        {
            "heading": "A.1 THEOREM 1",
            "text": "Theorem 1. Local linearization provides the optimal Gaussian approximation of a univariate Gaussian distribution transformed by a ReLU non-linearity with respect to the total variation:\nargmin (\u00b5\u0303,\u03c3\u0303) TV (P ,Q) = { (\u00b5, \u03c3) \u00b5 \u2265 0 (0, 0) otherwise\n(10)\nwhere P = N (\u00b5\u0303, \u03c3\u03032), Q = ReLU(N (\u00b5, \u03c32))\nProof. We distinguish 3 cases, \u00b5 < 0, \u00b5 = 0, and \u00b5 > 0:\n(\u00b5 < 0) In the first case, the true distribution has a probability mass of p0 > 0.5 at 0 because all values below 0 will be mapped to 0 and CDF(0) > 0.5. As the approximation is parameterized as (0, 0), it has a probability mass of 1 at 0. Therefore, the TV is |1 \u2212 p0| < 0.5. All parameterized distributions where \u03c3 > 0 have no probability mass at 0 and thus a TV of at least |0\u2212p0| = p0 > 0.5.\n(\u00b5 = 0) In this case, \u222b\u221e 0\n|p\u2212 q| d\u03bd = 0 because the distributions are equal on this domain. The true distribution has a probability mass of p0 = 0.5 at 0, therefore the TV is |0 \u2212 p0| = 0.5. In fact, all distributions with \u03c3 > 0 have a TV of at least 0.5 because |0\u2212 p0| = 0.5. The distribution parameterized by (0, 0) has the same TV at this point.\n(\u00b5 > 0) In this case, p0 = CDF(0) < 0.5. Further, again \u222b\u221e 0\n|p\u2212 q| d\u03bd = 0. Thus, the TV of our distribution is |0 \u2212 p0| = p0 < 0.5. All distributions with \u03c3 > 0 have a TV of at least p0 because |0\u2212 p0| = p0. The distribution parameterized by (0, 0) has a TV of |1\u2212 p0| > 0.5.\nThus, the approximation by linearization (Eq. 2) is the optimal approximation wrt. total variation.\nCorollary 2. Theorem 1 also applies to Cauchy distributions parameterized via x0, \u03b3 instead of \u00b5, \u03c3.\nThe proof of Theorem 1 also applies to Corollary 2. (\u00b5 is the median and \u03c3 is the scale.)\nA.2 CONSIDERATIONS FOR \u03b1-STABLE DISTRIBUTIONS\nA.2.1 AFFINE TRANSFORMATIONS FOR \u03b1-STABLE DISTRIBUTIONS\nGiven a marginal multivariate \u03b1-stable distribution X \u223c S(x0,diag(\u03b32), \u03b1, \u03b2) with x0 \u2208 R1\u00d7n,\u03b3 \u2208 R1\u00d7n\u22650 , the marginal Cauchy distribution of the transformation of X by a layer with a nonnegative weight A\u22650 \u2208 Rm\u00d7n\u22650 matrix and arbitrary bias b can be expressed via x0 7\u2192 x0A\u22a4\u22650 + b and \u03b3 7\u2192 (\u03b3\u03b1A\u22a4\u22650)1/\u03b1. Here, \u03b1 and \u03b2 remain invariant to the transformation.\nMoreover, for networks with real-valued weights and for centered distributions (\u03b2 = 0), we have x0 7\u2192 x0A\u22a4 + b and \u03b3\u0303 = (\u03b3\u03b1 Abs(A)\u22a4)1/\u03b1 where \u03b3\u0303 is an upper bound for the transformation\u2019s output\u2019s scale vector whenever it exists and otherwise parameterizes a stable distribution with greater spread than the exact true distribution (which, in this case, does not lie in the family of stable distributions). This can be seen from addition being an upper bound for the spread under subtraction.\nA.2.2 THEOREM 1 FOR \u03b1-STABLE DISTRIBUTIONS\nWhile we only use Theorem 1 for Gaussian and Cauchy distributions in this paper, in the following we show that it also holds more generally for all stable distributions: Corollary 3. Theorem 1 also applies to any \u03b1-stable distribution parameterized via a median \u00b5 and scale c instead of \u03c3. The (optional) skewness parameter \u03b2 remains the same if \u00b5 \u2265 0 and otherwise, when c = 0, the skewness parameter does not affect the distribution.\nThe proof of Theorem 1 also applies to Corollary 3 provided that \u00b5 is the median (for skewed distributions, this differs from the location parameter; for symmetric distributions, this is equivalent to the location parameter)."
        },
        {
            "heading": "A.3 CONVOLUTIONS",
            "text": "For two-dimensional convolutions, we use the notation Y = X\u2217W+B where X \u2208 Rc0\u00d7n0\u00d7n1 is the input (image), W \u2208 Rc1\u00d7c0\u00d7k0\u00d7k1 is the weight tensor, and B,Y \u2208 Rc1\u00d7m0\u00d7m1 are the bias and output tensors with c0, c1, k0, k1, n0, n1,m0,m1,m0,m1 \u2208 N+. Further, let XU \u2208 Rm0\u00d7m1\u00d7c0\u00d7k0\u00d7k1 be the unfolded sliding local blocks2 from tensor X such that\nYc1m0m1 = \u2211\nc0k0k1\nXUm0m1c0k0k1Wc1c0k0k1 +B = X \u2217 W +B. (11)\nMultivariate Gaussian Distribution. For the convolutional layer, \u00b5 \u2208 Rc0\u00d7n0\u00d7n1 ,\u03a3 \u2208 Rc0\u00d7n0\u00d7n1\u00d7c0\u00d7n0\u00d7n1 . Note that \u03a3U \u2208 Rm0\u00d7m1\u00d7c0\u00d7k0\u00d7k1\u00d7m0\u00d7m1\u00d7c0\u00d7k0\u00d7k1 is the unfolded sliding local blocks covariance of the covariance tensor \u03a3.\n\u00b5 7\u2192 \u00b5 \u2217 W + B (12) and\n\u03a3c1m0m1c\u20321m\u20320m\u20321 7\u2192 \u2211\nc0k0k1c\u20320k \u2032 0k \u2032 1\nWc1c0k0k1\u03a3 U m0m1c0k0k1m\u20320m \u2032 1c \u2032 0k \u2032 0k \u2032 1 Wc\u20321c\u20320k\u20320k\u20321 (13)\nMultivariate Marginal Gaussian Distribution. For the convolutional layer, \u00b5,\u03c3 \u2208 Rc0\u00d7n0\u00d7n1 .\n\u00b5 7\u2192 \u00b5 \u2217 W +B and \u03c32 7\u2192 \u03c32 \u2217 W2 (14)\nMultivariate Marginal Cauchy Distribution. For the convolutional layer, x0,\u03b3 \u2208 Rc0\u00d7n0\u00d7n1 .\nx0 7\u2192 x0 \u2217 W + B and \u03b3 7\u2192 \u03b3 \u2217Abs(W) (15) 2Einstein summation notation. The unfolded sliding local blocks are equivalent to torch.unfold."
        },
        {
            "heading": "B ADDITIONAL EXPERIMENTS",
            "text": ""
        },
        {
            "heading": "B.1 PROPAGATING GAUSSIAN DISTRIBUTIONS",
            "text": "Tab. 7\u201336 show additional simulations with 1, 2, 4, and 6 hidden layers as well as ReLU, Leaky-ReLU, GELU, SiLU, and logistic sigmoid activations.\nTab. 28 considers the average ratio between predicted and true standard deviations.\nAs we did not find a moment matching method for GELU and SiLU in the literature, we omit moment matching in these cases. DVIA [33] is only applicable to ReLU among the non-linearities we consider. For marginal moment matching with logistic sigmoid, we used numerical integration as we are not aware of a closed-form solution."
        },
        {
            "heading": "B.2 ADDITIONAL STANDARD DEVIATIONS FOR RESULTS IN THE MAIN PAPER",
            "text": ""
        },
        {
            "heading": "B.3 ADDITIONAL RESULTS FOR UCI UQ WITH MC ESTIMATE",
            "text": "Table 40 shows additional results for the UCI data set uncertainty quantification regression experiment. Here, we consider k \u2208 {5, 1000}. k = 5 frequently fails maintaining adequate prediction interval coverage probability (PICP). On the other hand k = 1000 is computationally quite expensive due to the requirement of 1000 neural network evaluations per data point."
        },
        {
            "heading": "B.4 GAUSSIAN AND ADVERSARIAL NOISE ROBUSTNESS",
            "text": "The robustness of neural networks has received significant attention in the past years [50]\u2013[52]. There are many methods for robustifying neural networks against random noise in the inputs or adversarially crafted perturbations. While our method is not explicitly designed for these purposes, however, it can be observed that it achieves meaningful robustness improvements. We evaluate the robustness of classification models trained with uncertainty propagation on the MNIST [26] and CIFAR-10 [53] data sets. We consider the following training scenarios: First, we propagate normal distributions with and without covariance and train using the pairwise Gaussian loss. Second, we train with Cauchy distribution propagation using the pairwise Cauchy loss. As for baselines, we compare to training with softmax cross-entropy as well as moment matching propagation with the Dirichlet output loss [20]. The network architectures, hyper-parameters, as well as the results on CIFAR-10 are presented in Sections B.4.1 and C.\nRandom Gaussian Noise To evaluate the random noise robustness of models trained with uncertainty propagation, we add random Gaussian per-pixel noise during evaluation. Specifically, we use input noise with \u03c3 = 0.5 (see Supplementary Material B.4.1 for \u03c3 \u2208 {0.25, 0.75}) and clamp the image to the original pixel value range (between 0 and 1). Figure 5 (left) shows the results for input standard deviations/scales from 10\u22129 to 104. For every input standard deviation, we train separate models. For each method, the range of good hyperparameters is around 4\u2212 6 orders of magnitude. We observe when training with uncertainty propagation and the pairwise Gaussian/Cauchy losses, the models are substantially more robust than with conventional training on the MNIST data set.\nAdversarial Noise To evaluate the adversarial robustness of models trained with uncertainty propagation, we use the projected gradient descent (PGD) attack [51] as a common benchmark. For measuring the adversarial robustness, we use L\u221e-bounded PGD, for MNIST with \u03f5 = 16/255 (and with \u03f5 = 8/255 in the SM), and for CIFAR with \u03f5 \u2208 {3/255, 4/255}. Figure 5 (right) shows the adversarial robustness of CNNs on distributions. We can see that the proposed method is competitive with the accuracy of the softmax cross-entropy loss and can even outperform it. It further shows that the proposed method, in combination with pairwise probability classification losses, outperforms both baselines in each case. We find that the adversarially most robust training method is propagating normal distributions with covariances, with a robust accuracy of 85% with \u03f5 = 16/255 on the MNIST data set compared to a robust accuracy of 14% for models trained with softmax cross-entropy, while the Dirichlet loss with moment-matching offers no robustness gains in this experiment. When training with SDP Gauss w/o cov., the models are only robust against adversarial noise for rather large input standard deviations. This effect is inverse for random Gaussian noise, where robustness against random noise is achieved when input standard deviations are rather small. On our models, we perform PGD with the PDLoss as well as PGD with softmax cross-entropy to ensure a thorough evaluation. In Section B.4.1, we provide results where a softmax CE-based objective is used by the adversary: our models are more robust against the CE-based attack than against the PDLoss-based attacks which are reported in the plot. While the proposed techniques are not as robust as methods specifically designed for that purpose, e.g., adversarial training [51], they show substantial improvements over training with cross-entropy."
        },
        {
            "heading": "B.4.1 ADDITIONAL PLOTS",
            "text": "In Fig. 7, we present an extension to Fig. 5 which demonstrates random and adversarial noise robustness for alternative noise intensities.\nIn Fig. 8 and 9, we present an additional demonstration of the adversarial and random noise robustness of CNNs on distributions. Note that we do not include results for normal distributions with covariances (as in Figures 5 and 7). Here, the emphasis is set on using both MNIST and CIFAR.\nIn Fig. 6, we show the robustness where a cross-entropy based objective (green) is used by the adversary. A cross-entropy based objective could be used in practice in multiple scenarios: For example, publishing just the weights of the model without information about the objective function, or by using a standard library for adversarial attacks that does not require or support specification of the training objective. Our models are more robust against the cross-entropy based attack (CE-PGD) than the pairwise distribution loss based attack (PA-PGD); thus, we report PA-PGD in all other plots.\nNote that the phenomenon of vanishing gradients can occur in our models (as it can also occur in any cross-entropy based model). Thus, we decided to consider all attempted attacks, where the gradient is zero or zero for some of the pixels in the input image, as successful attacks because the attack might be mitigated by a lack of gradients. In Fig. 6, we compare conventional robustness to robustness with the additional Gradient-Non-Zero (GNZ) requirement. We emphasize that we use the GNZ requirement also in all other plots.\nFor evaluating the robustness against random noise, we use input noise with \u03c3 \u2208 {0.25, 0.5, 0.75} and clamp the image to the original pixel value range."
        },
        {
            "heading": "B.5 MARGINAL PROPAGATION VISUALIZATION",
            "text": "We analyze the accuracy of a fully connected neural network (FCNN) where a Gaussian distribution is introduced in the kth out of 5 layers. Here, we utilize marginal SDP, i.e., propagation without covariances. The result is displayed in Figure 10, where we can observe that there is an optimal scale such that the accuracy is as large as possible. Further, we can see the behavior if the distribution is not introduced in the first layer, but in a later layer instead. That is, the first layers are conventional layers and the distribution is introduced after a certain number of layers. Here, we can see that the more layers propagate distributions rather than single values, the larger the optimal standard deviation is. The reason for this is that the scale of the distribution decays with each layer such that for deep models a larger input standard deviation is necessary to get an adequate output standard deviation for training the model. This is because we modeled the distributions without covariances, which demonstrates that propagating without covariances underestimates the variances.\nC IMPLEMENTATION DETAILS"
        },
        {
            "heading": "C.1 SIMULATION OF PROPAGATING NORMAL DISTRIBUTIONS",
            "text": "We trained a fully-connected neural network with 1, 2, or 4 hidden layers and ReLU / Leaky-ReLU activations for 5000 epochs on the Iris data set [43] via the softmax cross-entropy loss. Here, each hidden layer has 100 hidden neurons. Results are averaged over 10 runs, and 10 inputs are propagated for each of these 10 runs. Across all methods of propagating distributions, each Monte Carlo baseline as well as model weights are shared."
        },
        {
            "heading": "C.2 UCI UNCERTAINTY QUANTIFICATION",
            "text": "For the UCI uncertainty quantification experiment, we use the same hyperparameter and settings as [9]. That is, we use a network with 1 ReLU activated hidden layer, with 64 hidden neurons and train it for 5000 epochs. We perform this for 20 seeds and for a learning rate \u03b7 \u2208 {10\u22122, 10\u22123, 10\u22124} and weight decay \u2208 {0, 10\u22123, 10\u22122, 10\u22121, 1}. For the input standard deviation, we made a single initial run with input variance \u03c32 \u2208 {10\u22128, 10\u22127, 10\u22126, 10\u22125, 10\u22124, 10\u22123, 10\u22122, 10\u22121, 100} and then (for each data set) used 11 variances at a resolution of 100.1 around the best initial variance."
        },
        {
            "heading": "C.3 APPLYING SDP TO PNNS",
            "text": "Here, we formalize how to apply Gaussian SDP to Gaussian PNNs. Let the PNN be described by f\u00b5(x) and f\u03a3(x). Conventionally, the PNN accordingly predicts an output distribution of N (f\u00b5(x), f\u03a3(x)).\nUsing SDP, we extend the output distribution to\nf\u00b5(x) +N (0, f\u03a3(x)) +N (0,J(f\u00b5)\u03a3xJ(f\u00b5)\u22a4) = N (f\u00b5(x), f\u03a3(x) + J(f\u00b5)\u03a3xJ(f\u00b5)\u22a4) (16)\nwhere \u03a3x is the input covariance matrix for data point x."
        },
        {
            "heading": "C.4 SELECTIVE PREDICTION ON OUT-OF-DISTRIBUTION DATA",
            "text": "Here we use the same network architecture as for the robustness experiments in the next subsection (A CNN composed of two ReLU-activated convolutional layers with a kernel size of 3, a stride of 2, and hidden sizes of 64 and 128; followed by a convolutional layer mapping it to an output size of 10) and also train it for 100 epochs, however, at a learning rate of 10\u22123. For training with our uncertainty propagation, we use an input standard deviation of \u03c3 = 0.1. For training with uncertainty propagation via moment matching and the Dirichlet loss as in [20], we use an input standard deviation of \u03c3 = 0.01, which is what they use in their experiments and also performs best in our experiment."
        },
        {
            "heading": "C.5 GAUSSIAN AND ADVERSARIAL NOISE ROBUSTNESS",
            "text": "Here, our CNN is composed of two ReLU-activated convolutional layers with a kernel size of 3, a stride of 2, and hidden sizes of 64 and 128. After flattening, this is followed by a convolutional layer mapping it to an output size of 10. We have trained all models for 100 epochs with an Adam optimizer, a learning rate of 10\u22124, and a batch size of 128."
        },
        {
            "heading": "C.6 PROPAGATING WITHOUT COVARIANCES",
            "text": "The architecture of the 5-layer ReLU-activated FCNN is 784-256-256-256-256-10."
        },
        {
            "heading": "C.7 EVALUATION METRICS",
            "text": ""
        },
        {
            "heading": "C.7.1 COMPUTATION OF TOTAL VARIATION IN THE SIMULATION EXPERIMENTS",
            "text": "We compute the total variation using the following procedure: We sample 106 samples from the continuous propagated distribution. We bin the distributions into 10 \u00d7 10 \u00d7 10 bins (the output is 3-dimensional) and compute the total variation for the bins. Here, we have an average of 1000 samples per bin. For each setting, we compute this for 10 input points and on 10 models (trained with different seeds) each, so the results are averaged over 100 data point / model configurations. Between the different methods, we use the same seeds and oracles. To validate that this is reliable, we also tested propagating 107 samples, which yielded very similar results, but just took longer to compute the oracle. We also validated the evaluation methods by using a higher bin resolution, which also yielded very similar results."
        },
        {
            "heading": "C.7.2 COMPUTATION OF MPIW",
            "text": "Given a predicted mean and standard deviation, the Prediction Interval Width (for 95%) can be computed directly. In a normal distribution, 68.27% of samples lie within 1 standard deviation of the mean. For covering 95% of a Gaussian distribution, we need to cover \u00b11.96 standard deviations. Therefore, the PIW is 3.92 standard deviations. We computed the reported MPIW on the test data set. This setup follows the setup by [9]."
        },
        {
            "heading": "C.8 MAXPOOL",
            "text": "For MaxPool, we apply Equation 1 such that (\u00b5, \u03c3) 7\u2192 (max(\u00b5), argmax(\u00b5) \u00b7 \u03c3) where argmax yields a one-hot vector. The equation maxpools all inputs to one output; applying it to subsets of neurons correspondingly maxpools the respective subsets.\nD IMPLEMENTATIONS OF SDP: PSEUDO-CODE AND PYTORCH\nIn the following, we display a minimal Python-style pseudo code implementation of SDP.\n# Python style pseudo-code model = ... # neural network data = ... # inputs, e.g., images\ny = model(data) jac = jacobian(y, data)\noutput_mean = y output_cov = jac @ jac.T * std**2\nIn the following, we provide an optimized PyTorch implementation of SDP in the form of a wrapper.\n# PyTorch SDP wrapper implementation. (tested with PyTorch version 1.13.1)\nclass SDP(torch.nn.Module): def __init__(self, net, std=1., num_outputs=10, create_graph=True, vectorize=False):\nsuper(SDP, self).__init__() self.net = net self.std = std self.num_outputs = num_outputs self.create_graph = create_graph self.vectorize = vectorize # vectorize=True is only faster for large numbers of classes / small models\ndef forward(self, x): assert len(x.shape) >= 2, x.shape # First dimension is a batch dimension.\n# Two separate implementations: # the top one is for larger models and the bottom for smaller models. if not self.vectorize:\nx.requires_grad_() y = self.net(x) jacs = [] for i in range(self.num_outputs):\njacs.append(torch.autograd.grad( y[:, i].sum(0), x, create_graph=self.create_graph, retain_graph=True\n)[0]) jac = torch.stack(jacs, dim=1).reshape(\nx.shape[0], self.num_outputs, np.prod(x.shape[1:]) )\nelse: e = torch.zeros(x.shape[0] * self.num_outputs, self.num_outputs).to(x.device) for out_dim_idx in range(self.num_outputs):\ne[x.shape[0] * out_dim_idx:x.shape[0] * (out_dim_idx+1), out_dim_idx] = 1. vjps = torch.autograd.functional.vjp(\nself.net, x.repeat(self.num_outputs, *[1]*(len(x.shape)-1)), v=e, create_graph=self.create_graph, strict=True\n) y = vjps[0][:x.shape[0]] jac = vjps[1].view(\nself.num_outputs, x.shape[0], np.prod(x.shape[1:])).transpose(0, 1)\ncov = torch.bmm(jac, jac.transpose(-2, -1)) * self.std ** 2\nreturn y, cov\n# Usage example model = ... # neural network data = ... # inputs, e.g., images\nsdp_model = SDP(model, std=0.1, num_outputs=10) output_mean, output_cov = sdp_model(data)"
        }
    ],
    "title": "STABLE DISTRIBUTION PROPAGATION",
    "year": 2024
}