{
    "abstractText": "Fairness in artificial intelligence models has gained significantly more attention in recent years, especially in the area of medicine, as fairness in medical models is critical to people\u2019s well-being and lives. Highquality medical fairness datasets are needed to promote fairness learning research. Existing medical fairness datasets are all for classification tasks, and no fairness datasets are available for medical segmentation, while medical segmentation is an equally important clinical task as classifications, which can provide detailed spatial information on organ abnormalities ready to be assessed by clinicians. In this paper, we propose the first fairness dataset for medical segmentation named Harvard-FairSeg with 10,000 subject samples. In addition, we propose a fair error-bound scaling approach to reweight the loss function with the upper error-bound in each identity group, using the segment anything model (SAM). We anticipate that the segmentation performance equity can be improved by explicitly tackling the hard cases with high training errors in each identity group. To facilitate fair comparisons, we utilize a novel equity-scaled segmentation performance metric to compare segmentation metrics in the context of fairness, such as the equity-scaled Dice coefficient. Through comprehensive experiments, we demonstrate that our fair error-bound scaling approach either has superior or comparable fairness performance to the state-of-theart fairness learning models. The dataset and code are publicly accessible via https://ophai.hms.harvard.edu/datasets/harvard-fairseg10k.",
    "authors": [
        {
            "affiliations": [],
            "name": "Yu Tian"
        },
        {
            "affiliations": [],
            "name": "Min Shi"
        },
        {
            "affiliations": [],
            "name": "Yan Luo"
        },
        {
            "affiliations": [],
            "name": "Ava Kouhana"
        },
        {
            "affiliations": [],
            "name": "Tobias Elze"
        },
        {
            "affiliations": [],
            "name": "Mengyu Wang"
        }
    ],
    "id": "SP:7b4c2e71ba18dd2fa86153ba74879e4ecb2aaa29",
    "references": [
        {
            "authors": [
                "Alekh Agarwal",
                "Alina Beygelzimer",
                "Miroslav Dud\u0301\u0131k",
                "John Langford",
                "Hanna Wallach"
            ],
            "title": "A reductions approach to fair classification",
            "venue": "In International Conference on Machine Learning,",
            "year": 2018
        },
        {
            "authors": [
                "Alekh Agarwal",
                "Miroslav Dud\u0301\u0131k",
                "Zhiwei Steven Wu"
            ],
            "title": "Fair regression: Quantitative definitions and reduction-based algorithms",
            "venue": "In International Conference on Machine Learning,",
            "year": 2019
        },
        {
            "authors": [
                "Tom L Beauchamp"
            ],
            "title": "Methods and principles in biomedical ethics",
            "venue": "Journal of Medical ethics,",
            "year": 2003
        },
        {
            "authors": [
                "Alex Beutel",
                "Jilin Chen",
                "Zhe Zhao",
                "Ed H Chi"
            ],
            "title": "Data decisions and theoretical implications when adversarially learning fair representations",
            "venue": "arXiv preprint arXiv:1707.00075,",
            "year": 2017
        },
        {
            "authors": [
                "Peter J Bickel",
                "Eugene A Hammel",
                "J William O\u2019Connell"
            ],
            "title": "Sex bias in graduate admissions: Data from berkeley: Measuring bias is harder than is usually assumed, and the evidence is sometimes contrary to expectation",
            "year": 1975
        },
        {
            "authors": [
                "Jieneng Chen",
                "Yongyi Lu",
                "Qihang Yu",
                "Xiangde Luo",
                "Ehsan Adeli",
                "Yan Wang",
                "Le Lu",
                "Alan L Yuille",
                "Yuyin Zhou"
            ],
            "title": "Transunet: Transformers make strong encoders for medical image segmentation",
            "venue": "arXiv preprint arXiv:2102.04306,",
            "year": 2021
        },
        {
            "authors": [
                "Julia Dressel",
                "Hany Farid"
            ],
            "title": "The accuracy, fairness, and limits of predicting recidivism",
            "venue": "Science advances,",
            "year": 2018
        },
        {
            "authors": [
                "Matthew J Everett",
                "Jonathan D Oakley"
            ],
            "title": "Automated analysis of the optic nerve head: measurements, methods and representations, August",
            "year": 2015
        },
        {
            "authors": [
                "Matthew Groh",
                "Caleb Harris",
                "Luis Soenksen",
                "Felix Lau",
                "Rachel Han",
                "Aerin Kim",
                "Arash Koochek",
                "Omar Badri"
            ],
            "title": "Evaluating deep neural networks trained on clinical images in dermatology with the fitzpatrick 17k dataset",
            "venue": "In Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition,",
            "year": 2021
        },
        {
            "authors": [
                "Moritz Hardt",
                "Eric Price",
                "Nati Srebro"
            ],
            "title": "Equality of opportunity in supervised learning",
            "venue": "Advances in neural information processing systems,",
            "year": 2016
        },
        {
            "authors": [
                "Jeremy Irvin",
                "Pranav Rajpurkar",
                "Michael Ko",
                "Yifan Yu",
                "Silviana Ciurea-Ilcus",
                "Chris Chute",
                "Henrik Marklund",
                "Behzad Haghgoo",
                "Robyn Ball",
                "Katie Shpanskaya"
            ],
            "title": "Chexpert: A large chest radiograph dataset with uncertainty labels and expert comparison",
            "venue": "In Proceedings of the AAAI conference on artificial intelligence,",
            "year": 2019
        },
        {
            "authors": [
                "Alistair EW Johnson",
                "Tom J Pollard",
                "Nathaniel R Greenbaum",
                "Matthew P Lungren",
                "Chihying Deng",
                "Yifan Peng",
                "Zhiyong Lu",
                "Roger G Mark",
                "Seth J Berkowitz",
                "Steven Horng"
            ],
            "title": "Mimic-cxr-jpg, a large publicly available database of labeled chest radiographs",
            "venue": "arXiv preprint arXiv:1901.07042,",
            "year": 2019
        },
        {
            "authors": [
                "Jost B Jonas",
                "Antonio Bergua",
                "Paul Schmitz-Valckenberg",
                "Konstantinos I Papastathopoulos",
                "Wido M Budde"
            ],
            "title": "Ranking of optic disc variables for detection of glaucomatous optic nerve damage",
            "venue": "Investigative Ophthalmology & Visual Science,",
            "year": 2000
        },
        {
            "authors": [
                "Michael P Kim",
                "Amirata Ghorbani",
                "James Zou"
            ],
            "title": "Multiaccuracy: Black-box postprocessing for fairness in classification",
            "venue": "In Proceedings of the 2019 AAAI/ACM Conference on AI, Ethics, and Society,",
            "year": 2019
        },
        {
            "authors": [
                "Oleksandr Kovalyk",
                "Juan Morales-S\u00e1nchez",
                "Rafael Verd\u00fa-Monedero",
                "Inmaculada Sell\u00e9sNavarro",
                "Ana Palaz\u00f3n-Cabanes",
                "Jos\u00e9-Luis Sancho-G\u00f3mez"
            ],
            "title": "Papila: Dataset with fundus images and clinical data of both eyes of the same patient for glaucoma assessment",
            "venue": "Scientific Data,",
            "year": 2022
        },
        {
            "authors": [
                "Jakub Kuzilek",
                "Martin Hlosta",
                "Zdenek Zdrahal"
            ],
            "title": "Open university learning analytics dataset",
            "venue": "Scientific data,",
            "year": 2017
        },
        {
            "authors": [
                "Yuyuan Liu",
                "Yu Tian",
                "Chong Wang",
                "Yuanhong Chen",
                "Fengbei Liu",
                "Vasileios Belagiannis",
                "Gustavo Carneiro"
            ],
            "title": "Translation consistent semi-supervised segmentation for 3d medical images",
            "venue": "arXiv preprint arXiv:2203.14523,",
            "year": 2022
        },
        {
            "authors": [
                "Pranay K Lohia",
                "Karthikeyan Natesan Ramamurthy",
                "Manish Bhide",
                "Diptikalyan Saha",
                "Kush R Varshney",
                "Ruchir Puri"
            ],
            "title": "Bias mitigation post-processing for individual and group fairness. In Icassp 2019-2019 ieee international conference on acoustics, speech and signal processing (icassp)",
            "year": 2019
        },
        {
            "authors": [
                "Yan Luo",
                "Min Shi",
                "Yu Tian",
                "Tobias Elze",
                "Mengyu Wang"
            ],
            "title": "Harvard glaucoma detection and progression: A multimodal multitask dataset and generalization-reinforced semisupervised learning",
            "venue": "In Proceedings of the IEEE/CVF International Conference on Computer Vision, pp. 20471\u201320482,",
            "year": 2023
        },
        {
            "authors": [
                "Yan Luo",
                "Yu Tian",
                "Min Shi",
                "Tobias Elze",
                "Mengyu Wang"
            ],
            "title": "Eye fairness: A large-scale 3d imaging dataset for equitable eye diseases screening and fair identity scaling",
            "venue": "arXiv preprint arXiv:2310.02492,",
            "year": 2023
        },
        {
            "authors": [
                "Yan Luo",
                "Yu Tian",
                "Min Shi",
                "Tobias Elze",
                "Mengyu Wang"
            ],
            "title": "Harvard glaucoma fairness: A retinal nerve disease dataset for fairness learning and fair identity normalization",
            "venue": "arXiv preprint arXiv:2306.09264,",
            "year": 2023
        },
        {
            "authors": [
                "David Madras",
                "Elliot Creager",
                "Toniann Pitassi",
                "Richard Zemel"
            ],
            "title": "Learning adversarially fair and transferable representations",
            "venue": "In International Conference on Machine Learning,",
            "year": 2018
        },
        {
            "authors": [
                "Weiwen Miao"
            ],
            "title": "Did the results of promotion exams have a disparate impact on minorities? using statistical evidence in ricci v. destefano",
            "venue": "Journal of Statistics Education,",
            "year": 2010
        },
        {
            "authors": [
                "Christoph Mitsch",
                "Stephan Holzer",
                "Lorenz Wassermann",
                "Hemma Resch",
                "Susanne Urach",
                "Barbara Kiss",
                "Anton Hommer",
                "Clemens Vass",
                "Ursula Schmidt-Erfurth"
            ],
            "title": "Comparison of spectralis and cirrus spectral domain optical coherence tomography for the objective morphometric assessment of the neuroretinal rim width",
            "venue": "Graefe\u2019s Archive for Clinical and Experimental Ophthalmology,",
            "year": 2019
        },
        {
            "authors": [
                "Marc Modat",
                "David M Cash",
                "Pankaj Daga",
                "Gavin P Winston",
                "John S Duncan",
                "S\u00e9bastien Ourselin"
            ],
            "title": "Global image registration using a symmetric block-matching approach",
            "venue": "Journal of medical imaging,",
            "year": 2014
        },
        {
            "authors": [
                "Sungho Park",
                "Jewook Lee",
                "Pilhyeon Lee",
                "Sunhee Hwang",
                "Dohyung Kim",
                "Hyeran Byun"
            ],
            "title": "Fair contrastive learning for facial attribute classification",
            "venue": "In Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition,",
            "year": 2022
        },
        {
            "authors": [
                "Novi Quadrianto",
                "Viktoriia Sharmanska",
                "Oliver Thomas"
            ],
            "title": "Discovering fair representations in the data domain",
            "venue": "In Proceedings of the IEEE/CVF conference on computer vision and pattern recognition,",
            "year": 2019
        },
        {
            "authors": [
                "Vikram V Ramaswamy",
                "Sunnie SY Kim",
                "Olga Russakovsky"
            ],
            "title": "Fair attribute classification through latent space de-biasing",
            "venue": "In Proceedings of the IEEE/CVF conference on computer vision and pattern recognition,",
            "year": 2021
        },
        {
            "authors": [
                "Yuji Roh",
                "Kangwook Lee",
                "Steven Whang",
                "Changho Suh"
            ],
            "title": "Fr-train: A mutual information-based approach to fair and robust training",
            "venue": "In International Conference on Machine Learning,",
            "year": 2020
        },
        {
            "authors": [
                "Steven Ruggles",
                "Robert McCaa",
                "Matthew Sobek",
                "Lara Cleveland"
            ],
            "title": "The ipums collaboration: integrating and disseminating the world\u2019s population microdata",
            "venue": "Journal of demographic economics,",
            "year": 2015
        },
        {
            "authors": [
                "Shiori Sagawa",
                "Pang Wei Koh",
                "Tatsunori B Hashimoto",
                "Percy Liang"
            ],
            "title": "Distributionally robust neural networks for group shifts: On the importance of regularization for worst-case generalization",
            "year": 1911
        },
        {
            "authors": [
                "Mhd Hasan Sarhan",
                "Nassir Navab",
                "Abouzar Eslami",
                "Shadi Albarqouni"
            ],
            "title": "Fairness by learning orthogonal disentangled representations",
            "venue": "In Computer Vision\u2013ECCV 2020: 16th European Conference,",
            "year": 2020
        },
        {
            "authors": [
                "Min Shi",
                "Anagha Lokhande",
                "Mojtaba S Fazli",
                "Vishal Sharma",
                "Yu Tian",
                "Yan Luo",
                "Louis R Pasquale",
                "Tobias Elze",
                "Michael V Boland",
                "Nazlee Zebardast"
            ],
            "title": "Artifact-tolerant clustering-guided contrastive embedding learning for ophthalmic images in glaucoma",
            "venue": "IEEE Journal of Biomedical and Health Informatics,",
            "year": 2023
        },
        {
            "authors": [
                "Min Shi",
                "Yan Luo",
                "Yu Tian",
                "Lucy Q Shen",
                "Tobias Elze",
                "Nazlee Zebardast",
                "Mohammad Eslami",
                "Saber Kazeminasab",
                "Michael V Boland",
                "David S Friedman"
            ],
            "title": "Equitable artificial intelligence for glaucoma screening with fair identity normalization",
            "venue": "medRxiv, pp. 2023\u201312,",
            "year": 2023
        },
        {
            "authors": [
                "Min Shi",
                "Jessica A Sun",
                "Anagha Lokhande",
                "Yu Tian",
                "Yan Luo",
                "Tobias Elze",
                "Lucy Q Shen",
                "Mengyu Wang"
            ],
            "title": "Artifact correction in retinal nerve fiber layer thickness maps using deep learning and its clinical utility in glaucoma",
            "venue": "Translational Vision Science & Technology,",
            "year": 2023
        },
        {
            "authors": [
                "Yih-Chung Tham",
                "Xiang Li",
                "Tien Y Wong",
                "Harry A Quigley",
                "Tin Aung",
                "Ching-Yu Cheng"
            ],
            "title": "Global prevalence of glaucoma and projections of glaucoma burden through 2040: a systematic review and meta-analysis",
            "year": 2014
        },
        {
            "authors": [
                "Yu Tian",
                "Fengbei Liu",
                "Guansong Pang",
                "Yuanhong Chen",
                "Yuyuan Liu",
                "Johan W Verjans",
                "Rajvinder Singh",
                "Gustavo Carneiro"
            ],
            "title": "Self-supervised pseudo multi-class pre-training for unsupervised anomaly detection and segmentation in medical images",
            "venue": "Medical Image Analysis,",
            "year": 2023
        },
        {
            "authors": [
                "Yu Tian",
                "Guansong Pang",
                "Yuyuan Liu",
                "Chong Wang",
                "Yuanhong Chen",
                "Fengbei Liu",
                "Rajvinder Singh",
                "Johan W Verjans",
                "Mengyu Wang",
                "Gustavo Carneiro"
            ],
            "title": "Unsupervised anomaly detection in medical images with a memory-augmented multi-level crossattentional masked autoencoder",
            "venue": "In International Workshop on Machine Learning in Medical Imaging,",
            "year": 2023
        },
        {
            "authors": [
                "Sahil Verma",
                "Julia Rubin"
            ],
            "title": "Fairness definitions explained",
            "venue": "In Proceedings of the international workshop on software fairness,",
            "year": 2018
        },
        {
            "authors": [
                "Risheng Wang",
                "Tao Lei",
                "Ruixia Cui",
                "Bingtao Zhang",
                "Hongying Meng",
                "Asoke K Nandi"
            ],
            "title": "Medical image segmentation using deep learning: A survey",
            "venue": "IET Image Processing,",
            "year": 2022
        },
        {
            "authors": [
                "Zhibo Wang",
                "Xiaowei Dong",
                "Henry Xue",
                "Zhifei Zhang",
                "Weifeng Chiu",
                "Tao Wei",
                "Kui Ren"
            ],
            "title": "Fairness-aware adversarial perturbation towards bias mitigation for deployed deep models",
            "venue": "In Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition,",
            "year": 2022
        },
        {
            "authors": [
                "Linda F Wightman"
            ],
            "title": "Lsac national longitudinal bar passage study",
            "venue": "lsac research report series",
            "year": 1998
        },
        {
            "authors": [
                "Muhammad Bilal Zafar",
                "Isabel Valera",
                "Manuel Gomez Rogriguez",
                "Krishna P Gummadi"
            ],
            "title": "Fairness constraints: Mechanisms for fair classification",
            "venue": "In Artificial intelligence and statistics,",
            "year": 2017
        },
        {
            "authors": [
                "Brian Hu Zhang",
                "Blake Lemoine",
                "Margaret Mitchell"
            ],
            "title": "Mitigating unwanted biases with adversarial learning",
            "venue": "In Proceedings of the 2018 AAAI/ACM Conference on AI, Ethics, and Society,",
            "year": 2018
        },
        {
            "authors": [
                "Kaidong Zhang",
                "Dong Liu"
            ],
            "title": "Customized segment anything model for medical image segmentation",
            "venue": "arXiv preprint arXiv:2304.13785,",
            "year": 2023
        },
        {
            "authors": [
                "Yi Zhang",
                "Jitao Sang"
            ],
            "title": "Towards accuracy-fairness paradox: Adversarial example-based data augmentation for visual debiasing",
            "venue": "In Proceedings of the 28th ACM International Conference on Multimedia,",
            "year": 2020
        },
        {
            "authors": [
                "Zhifei Zhang",
                "Yang Song",
                "Hairong Qi"
            ],
            "title": "Age progression/regression by conditional adversarial autoencoder",
            "venue": "In Proceedings of the IEEE conference on computer vision and pattern recognition,",
            "year": 2017
        },
        {
            "authors": [
                "Yongshuo Zong",
                "Yongxin Yang",
                "Timothy Hospedales"
            ],
            "title": "Medfair: Benchmarking fairness for medical imaging",
            "venue": "arXiv preprint arXiv:2210.01725,",
            "year": 2022
        }
    ],
    "sections": [
        {
            "heading": "1 Introduction",
            "text": "As the use of artificial intelligence grows in medical image diagnosis, it\u2019s vital to ensure the fairness of these deep learning models and delve into hidden biases that could arise in complex real-world scenarios. Regrettably, machine learning models can inadvertently incorporate sensitive attributes (like race and gender) associated with medical images, which could influence the model\u2019s ability to differentiate abnormalities. This challenge has spurred significant efforts to investigate biases, champion fairness, and launch new datasets in the fields of machine learning and computer vision. To date, only a few public fairness datasets have been proposed for studying the fairness classification Dressel & Farid (2018); Asuncion & Newman (2007); Wightman (1998); Miao (2010); Kuzilek et al. (2017); Ruggles et al. (2015); Zhang et al. (2017); Zong et al. (2022); Irvin et al. (2019); Johnson et al. (2019); Kovalyk et al. (2022). Predominantly, most of those datasets Dressel & Farid (2018); Asuncion & Newman (2007); Wightman (1998); Miao (2010); Kuzilek et al. (2017); Ruggles et al. (2015); Zhang et al. (2017) consist of tabular data, making them ill-suited for developing fair computer vision models that demand imaging data. This gap is concerning, especially considering the rise of impactful\n\u2217Contributed equally as co-first authors\ndeep-learning models dependent on such data. In the field of medical imaging, only a handful of datasets Irvin et al. (2019); Johnson et al. (2019); Kovalyk et al. (2022) have been used for fairness learning. However, most of these datasets were not explicitly crafted with fairness modeling. They often include only a limited range of sensitive attributes, like age, gender, and race, thus constricting the scope of examining fairness among varied demographic groups. Additionally, they also lack a thorough benchmarking framework. More importantly, while those previous datasets and approaches offer solutions for medical classification, they overlook the arguably more critical field of medical segmentation. Medical segmentation Liu et al. (2022); Tian et al. (2023a); Chen et al. (2021); Tian et al. (2023b); Zhou et al. (2018); Wang et al. (2022a) provides detailed spatial information on specific anatomical structures, essential for personalized treatments, monitoring disease progression, and enhancing diagnostic accuracy. In contrast to classification\u2019s broad categorization, segmentation\u2019s precise delineation offers in-depth information about organ abnormalities, facilitating better patient care from diagnosis to therapeutic interventions. Despite its significance, there\u2019s a glaring absence of public datasets for studying fairness in medical segmentation across diverse sensitive attributes. Given the importance of ensuring fairness in medical segmentation and the special characteristics of medical data, we argue that a large-scale medical segmentation dataset that is designed to study fairness and provide a playground for developing algorithmic debiasing approaches is crucial. However, creating such a new benchmark for fairness learning presents multiple challenges. First, there\u2019s a scarcity of large-scale, high-quality medical data paired with manual pixel-wise annotations, both of which are labor-intensive and time-consuming to collect and annotate. Second, existing methods Park et al. (2022); Wang et al. (2022b); Beutel et al. (2017) are primarily designed for medical classification, and the performance remains questionable when adapting to segmentation tasks. It is also uncertain whether the unfairness that exists in the segmentation tasks can be effectively alleviated by algorithms. Lastly, a universal metric for evaluating the fairness of medical segmentation models remains elusive. Furthermore, adapting existing fairness metrics designed for classification to segmentation tasks can also be challenging. In order to address these challenges, we propose the first large-scale fairness dataset for medical segmentation, named Harvard-FairSeg, which is designed for fairness optic disc and cup segmentation from SLO fundus images for diagnosing glaucoma, as shown in Figure 1. Glaucoma, a prominent cause of irreversible global blindness, has a prevalence of 3.54% in the 40-80 age bracket, affecting roughly 80 million individuals Tham et al. (2014); Luo et al. (2023b); Shi et al. (2023a); Luo et al. (2023a); Shi et al. (2023c). Despite its significance, early glaucoma often remains asymptomatic, emphasizing the need for timely professional tests. Accurate segmentation of the optic disc and cup is crucial for early glaucoma diagnosis by healthcare professionals. It\u2019s important to note that Black individuals face a doubled risk of developing glaucoma compared to other groups, yet the segmentation accuracy is often lowest for this demographic. This motivates us to curate a dataset for studying segmentation fairness issues before the practical use of any segmentation models in the real world. Particularly, the highlights of our proposed Harvard-FairSeg dataset are as follows: (1) The first fairness learning dataset for medical segmentation. The dataset provides optic disc and cup segmentation with SLO fundus imaging data; (2) The dataset is equipped with six sensitive attributes collected from real-world clinical scenarios for the study of fairness learning problem; (3) We evaluate multiple SOTA fairness learning algorithms on our proposed new dataset with various segmentation performance metrics including Dice coefficient and intersection over union (IoU). In addition to our valuable dataset, we develop a fair error-bound scaling (FEBS) approach as an add-on contribution to demonstrate that the fairness challenges in medical segmentation can indeed be tackled. The core idea of our FEBS approach is to rescale the loss function with the upper training error-bound of each identity group. The rationale is that the hard cases in each identity group may be the driving factors for the underlying performance disparities, and the hard cases in each identity group may be due to pathophysiological and anatomical differences between identity groups. For instance, Asians have more angle-closure glaucoma compared with Whites, and Blacks have a larger cup-to-disc ratio compared with other races. Explicitly tackling the hard cases by using upper error-bound in each identity group may help reduce model performance inequity. We\nsubsequently integrate our proposed FEBS (Fair Error-Bound Scaling) approach with the recent segmentation foundation model, the Segment Anything Model (SAM) Kirillov et al. (2023), to explore whether FEBS enhances segmentation fairness across various sensitive attributes. To facilitate the comparison between different fairness learning models, we propose equityscaled performance metrics. More specifically, for instance, the ES-Dice is calculated as the overall Dice coefficients divided by the summation of the relative disparity between the overall Dice coefficients and the group Dice coefficients. This equity-scaled segmentation performance metric provides a more straightforward evaluation and is easier to interpret by clinicians than existing fairness metrics such as demographic parity difference (DPD) and difference in equalized odds (DEOdds) . Our core contributions are summarized as follows:\n\u2022 Major: We introduce the first fairness dataset for medical segmentation and benchmarked it with the state-of-the-art (SOTA) fairness learning approaches.\n\u2022 Minor 1: We develop a novel fair error-bound scaling approach to improve segmentation performance equity.\n\u2022 Minor 2: We design a new equity-scaled segmentation performance metric to facilitate fair comparisons between different fairness learning models for medical segmentation."
        },
        {
            "heading": "2 Related Work",
            "text": "Medical Fairness Datasets. Healthcare disparities in disadvantaged minority groups have been a significant concern due to heightened disease susceptibility and underdiagnosis. Although deep learning provides solutions for addressing this by automating disease detection, it is essential to address the potential for performance biases. Existing medical fairness datasets such as CheXpert Irvin et al. (2019), MIMIC-CXR Johnson et al. (2019), and Fitzpatrick17k Groh et al. (2021) focus on image classification and often neglect the vital domain of medical segmentation. Additionally, their limited set of sensitive attributes like age, sex, and race reduces versatility in fairness system development. In this work, we introduce the first segmentation-focused medical fairness dataset, encompassing attributes like age, gender, race, and ethnicity in segmentation tasks. Fairness Learning. Biases in computer vision datasets arise from data inequalities, leading to skewed predictions. Strategies to mitigate these biases are categorized into pre-processing, in-processing, and post-processing. Pre-processing methods, like those in Quadrianto et al. (2019); Ramaswamy et al. (2021); Zhang & Sang (2020); Park et al. (2022), debias training data, but may compromise computational efficiency. In-processing methods integrate fairness during model training but might sacrifice accuracy due to loss function manipulations Beutel et al. (2017); Roh et al. (2020); Sarhan et al. (2020); Zafar et al. (2017); Zhang et al. (2018); Shi et al. (2023b). Post-processing methods offer corrective measures but have limitations during testing Wang et al. (2022b); Kim et al. (2019); Lohia et al. (2019). Our work proposes a novel fair error-bound scaling approach, hypothesizing that addressing hard cases within identity groups could enhance model fairness performance. Fairness Metrics. Fairness definitions vary based on application context. Group fairness, as described in Verma & Rubin (2018), ensures impartiality within demographic groups but may sometimes compromise individual fairness. This trade-off can conflict with\nmedical ethics, emphasizing the need for methods that prioritize both group and individual fairness Beauchamp (2003). Some argue that Max-Min fairness complements group fairness metrics Zong et al. (2022). Common fairness metrics include Demographic Parity Difference (DPD) Bickel et al. (1975); Agarwal et al. (2018; 2019), Difference in Equal Opportunity (DEO) Hardt et al. (2016), and Difference in Equalized Odds (DEOdds) Agarwal et al. (2018). In crucial medical scenarios, prioritizing group fairness over accuracy is not viable. We introduce an equity scaling mechanism, aligning segmentation accuracy with group fairness, offering a comprehensive perspective on both performance and fairness."
        },
        {
            "heading": "3 Fair Disc-Cup Segmentation",
            "text": "Disc-Cup Segmentation Framework. In ophthalmology, disc-cup segmentation serves as a foundational step in assessing the optic nerve head structures and diagnosing glaucoma in its early stage. We represent a scanning laser ophthalmoscopy (SLO) fundus image as x \u2208 X \u2282 RH\u00d7W \u00d7C , where H \u00d7 W denotes the spatial resolution and C signifies the channel count. Our objective is to predict a segmentation map, S\u0302, with a resolution of H \u00d7 W . Every pixel in this map is associated with a class from the set Y = {y0, y1, y2}, where y0 represents the background, y1 denotes the optic disc, and y2 indicates the cup. The overall objective is to construct a model f\u03b8 : Rd\n\u03b8\u2212\u2192 S\u0302 capable of predicting this segmentation mask S\u0302, where \u03b8 denotes the segmentation model\u2019s parameters. The segmentation model f\u03b8 can be implemented using various SOTA models, such as SAM Kirillov et al. (2023) and TransUNet Chen et al. (2021). This task is important because vertical cup-to-disc ratio (CDR) Jonas et al. (2000) is accepted and commonly used by clinicians as a prime metric for the early detection of glaucoma. It is computed by determining the ratio of the vertical cup diameter (VCD) to the vertical disc diameter (VDD). An SLO fundus image vividly portrays the optic disc (OD) as a distinguishable bright white/gray oval in its center, split into the inner bright optic cup (OC) and the outer neuroretinal rim. An increasing CDR generally hints at a larger risk of glaucoma, underscoring the importance of precise disc and cup segmentation. Setting out with an ambition of fair segmentation, our FairSeg framework aims to ensure consistent and unbiased disc-cup delineation across diverse demographic groups. In practice, we observe significant bias between different demographic groups, and this can be caused by many factors (e.g., healthy subjects from the Black racial group tend to obtain slightly larger CDR than other groups). This venture is not merely a technical pursuit but carries profound societal implications, making it crucial to infuse fairness in our methodology. Incorporating Fairness in Segmentation. Attaining accurate segmentations remains pivotal; however, ensuring the system\u2019s fairness across various demographic groups also amplifies its clinical importance. Thus, in our Harvard-FairSeg dataset, each image comes with an associated sensitive attribute a \u2208 A. This attribute embodies critical social demographics such as race A = {Asian, Black or African American, White or Caucasian}, gender A = {Female, Male}, ethnicity A = {Non-Hispanic, Hispanic}, and preferred language A = {English, Spanish, Others}. For simplicity, we digitize these categories to A = {0, 1, 2} or A = {0, 1}. Incorporating the fairness learning paradigms into disc-cup segmentation, our goal extends to training f\u03b8 not only for segmentation precision but also to ensure equitable performance across the diverse sensitive attributes."
        },
        {
            "heading": "4 Dataset Analysis",
            "text": "Data Collection and Quality Control. Our institute\u2019s institutional review board (IRB) approved this study, which followed the principles of the Declaration of Helsinki. Since the study was retrospective, the IRB waived the requirement for informed consent from patients. The subjects tested between 2010 and 2021 are from a large academic eye hospital. There are three types of data to be released in this study: (1) SLO fundus imaging scans; (2) patient demographics; and (3) disc-cup masks annotated automatically from the OCT machine and manually graded by professional medical practitioners. Particularly, the pixel annotations of disc and cup regions are first acquired from the OCT machine, where the disc border in 3D\nOCT is segmented as the Bruch\u2019s membrane opening by the OCT manufacturer software, and the cup border is detected as the intersection between the inner limiting membrane (ILM) and the plane that results in minimum surface area from the intersection and disc border on the plane Mitsch et al. (2019); Everett & Oakley (2015). Approximately, cup border can be considered as the closest location on the ILM to the disc border, which is defined as the Bruch\u2019s membrane opening. Both Bruch\u2019s membrane opening and the internal limiting membrane can be easily segmented due to the high contrast between them and the background. Since the OCT manufacturer software leverages 3D information, the disc and cup segmentation is generally reliable. In comparison, 2D disc and cup segmentation on fundus photos can be challenging due to various factors including attenuated imaging signal and blood vessel obstruction. However, OCT machines are fairly expensive and less prevalent in primary care, therefore, we propose to migrate those annotations from 3D OCT to 2D SLO fundus for potentially broader impact in early-stage glaucoma screening in the primary care domains. Specifically, we first align the SLO fundus images with OCTderived fundus (OCT fundus) images utilizing the NiftyReg registration tool Modat et al. (2014). Subsequently, the affine metric from NiftyReg is applied to the disc-cup masks of the OCT fundus images, aligning them to the SLO fundus images. This procedure effectively produces a plethora of high-caliber SLO fundus mask annotations, sidestepping the laborintensive manual pixel annotation process. It\u2019s noteworthy that this registration operation demonstrates considerable precision in real-world scenarios, as evident from our empirical observations that highlight an approximate 80% success rate in registrations. Post this automated process, the generated masks undergo rigorous examination and are hand-graded by a panel of five medical professionals to ascertain the precise annotation of the disc-cup regions and exclude masks with incorrect disc or cup locations and failed registrations. Data Characteristics. Our Harvard-FairSeg dataset contains 10,000 samples from 10,000 subjects. We divide our data into the training set with 8,000 samples, and the test set with 2,000 samples. The dataset\u2019s collective age average is 60.3 \u00b1 16.5 years. Within this dataset, six sensitive attributes including age, gender, race, ethnicity, preferred language, and marital status, are included for in-depth fairness learning studies. In particular, regarding racial demographics, the dataset includes samples from three major groups: Asian, with 919 samples; Black, with 1,473 samples; and White, with 7,608 samples. Gender-wise, females constitute 58.5% of the subjects, with the remainder being males. The ethnic distribution is highlighted by 90.6% Non-Hispanic, 3.7% Hispanic, and 5.7% unspecified. In terms of preferred language, 92.4% of the subjects prefer English, 1.5% prefer Spanish, 1% prefer other languages, and 5.1% remain unidentified. From a marital status perspective, 57.7% are in a marriage or partnered, 27.1% are single, 6.8% have experienced divorce, 0.8% are legally separated, 5.2% are widowed, and 2.4% are not specified."
        },
        {
            "heading": "5 Methodology for Understanding Debiasing",
            "text": "In this section, we introduce our proposed fair error-bound scaling approach, which modifies the Dice loss to adjust pixel-wise weights of samples from different sensitive groups. Moreover, after recognizing the potential shortcomings of standard fairness metrics in medical contexts is primarily their potential discord with overall performance (i.e., Dice for segmentation or AUC for classification) and their sensitivity to data quality, we further\nadvocate for an equity scaling metric for segmentation tasks. This metric integrates demographic-dependent equity considerations with primary segmentation performance metrics, including Dice and IoU. Fair Error-Bound Scaling. As aforementioned, we denote an image x \u2208 X \u2282 RH\u00d7W \u00d7C , and our objective is to predict a segmentation map, S\u0302, with a resolution of H \u00d7 W . Every pixel in this map is associated with a class from the set Y = {y0, y1, y2}, where y0 represents the background, y1 denotes the optic disc, and y2 indicates the cup. Each image comes with an associated sensitive attribute a \u2208 A. This attribute embodies critical social demographics that have been introduced in Section. 3. We hypothesize that the group of samples that obtain smaller overall dice loss means the model learns better for the samples from that certain group, and therefore, requires smaller weights for these groups of samples. While, in contrast, the group with larger overall dice loss (i.e., hard cases) may lead to worse generalization and cause more algorithmic bias, which requires larger learning weights for these groups of samples. Therefore, we propose a new fair error-bound scaling method for scaling the dice losses between different demographic groups during training. We first define the standard Dice loss between predicted pixel scores y\u0302 and the ground truth targets y is represented as:\nD(y\u0302, y) = 1 \u2212 2 \u00d7 I(y\u0302, y) + \u03f5\u2211 y\u03022 + \u2211 y2) + \u03f5 , (1)\nwhere the intersect function I calculates the element-wise multiplication between the predicted pixel scores y\u0302 and the target y. To ensure fairness across different attribute groups, we augment the Dice loss above with a novel Fair Error-Bound Scaling mechanism. This results in the loss function below:\nLfair(y\u0302, y, a) = 1\n|Y| |Y|\u2211 i=1 \u2126i \u00d7 D(y\u0302i \u00d7 |A|\u2211 a=1 Wa, yi), (2)\nwhere \u2126i denotes the weight for target class i, and Wa is the weight list corresponding to a particular attribute. The weight list W for the sensitive attribute a \u2208 A can be formulated as:\nWa = tanh (( min( \u2211|Y|\ni=1 D(y\u0302[a]i, y[a]i))\u2211|Y| i=1 D(y\u0302[a]i, y[a]i)\n)\u03b3) (3)\nBy modulating predicted pixel scores with these attribute weights, this loss ensures that different attribute groups contribute balancedly to the loss function during model training, thereby promoting fairness. Equity-Scaled Metric for Fair Segmentation. In the field of medical image segmentation, the need to address demographic fairness has become increasingly paramount. Traditional segmentation metrics like Dice and IoU offer insights into the segmentation performance but may not capture the fairness across diverse demographic groups effectively. Considering this, our goal is to present a new metric that encapsulates both the efficiency of the segmentation and its fairness across different demographics. This gives rise to a holistic perspective, ensuring models that are both accurate and fair. Let I \u2208 {Dice, IoU, . . .} represent a segmentation metric. Conventional segmentation metrics, like Dice and IoU, can be expressed as M({(z\u2032, y)}), where they assess the overlap between the predicted segmentation z\u2032 and the ground truth y. However, these metrics often overlook the demographic-sensitive attribute information of the samples. Inspired by Luo et al. (2023c), to incorporate group-wise fairness, we need to evaluate the performance across each demographic group individually. Let\u2019s denote the set of all demographic groups as A. To integrate demographic fairness, we first define a performance discrepancy \u2206 for segmentation metrics, similar to Equation (4), as follows:\n\u2206 = \u2211 A\u2208A |I({(z\u2032, y)}) \u2212 I({(z\u2032, a, y)|a = A})| (4)\nHere, \u2206 measures the aggregate deviation of each demographic group\u2019s performance from the overall performance. It approaches zero when all groups achieve similar segmentation accuracy.\nWhen we consider the fairness across different groups, we need to compute the relative disparity between the overall segmentation accuracy and that within each demographic groups. With this, the Equity-Scaled Segmentation Performance (ESSP) metric, ESSP, is defined as:\nESSP = I({(z \u2032, y)})\n1 + \u2206 (5)\nThis formulation ensures that ESSP is always less than or equal to I. As \u2206 diminishes (indicating equitable segmentation performance across groups), ESSP converges to the traditional metric I. Conversely, a higher \u2206 signifies greater disparity in segmentation performance across demographics, resulting in a lower ESSP score. This approach allows us to evaluate segmentation models not only for their accuracy (as measured by Dice, IoU, etc.) but also for their fairness across different demographic groups. This makes the ESSP scoring function a pivotal metric in ensuring both segmentation accuracy and fairness in medical imaging tasks. Please note that an alternative method for gauging equityscaled segmentation performance involves directly utilizing standard deviation to quantify disparities across different groups. However, this approach, reliant on standard deviation, tends to yield only subtle variations between overall and equity-scaled performances. Such minor discrepancies can restrict its effectiveness in accurately quantifying fairness across various algorithms. For comprehensive insights, we also include results derived from this standard deviation-based metric in the appendix."
        },
        {
            "heading": "6 Experiment & Analysis",
            "text": ""
        },
        {
            "heading": "6.1 Algorithms",
            "text": "Segmentation Models. We select two segmentation models to investigate the fair segmentation problem, including the recent SOTA SAMed Zhang & Liu (2023) model and a classic TransUNet Chen et al. (2021). The SAMed approach Zhang & Liu (2023) offers a novel solution for medical image segmentation, drawing inspiration from the expansive capabilities of the recent Segment Anything Model (SAM) Kirillov et al. (2023). Pioneering a new paradigm, SAMed tailors the large-scale SAM image encoder to cater specifically to medical images. By employing the Low-rank-based (LoRA) fine-tuning strategy, SAMed efficiently adapts the SAM image encoder for medical scenarios. The LoRA modules are integrated into both the prompt encoder and mask decoder, and the model is fine-tuned on labeled medical image segmentation datasets. TransUNet Chen et al. (2021) represents a harmonious integration of transformer architectures with the established U-Net design principles, tailored specifically for medical imaging. It combines the strength of CNN backbones for spatial information extraction with the power of transformers to capture longrange dependencies in images. By utilizing the self-attention mechanism of transformers, TransUNet ensures that even distant regions in an image are effectively related, while its UNet architecture helps preserve vital spatial hierarchies, making it a potent tool for medical image segmentation. Fairness Algorithms. For our proposed fair segmentation, we employed several state-ofthe-art fairness techniques as baselines:\n1. Adversarially Fair Representations (ADV): Introduced by Madras et al. Madras et al. (2018), ADV aims to curate unbiased representations. It refines the model such that sensitive attributes are difficult to deduce from its representations, effectively minimizing inherent biases.\n2. Group Distributionally Robust Optimization (GroupDRO): Proposed by Sagawa et al. Sagawa et al. (2019), GroupDRO seeks to enhance model robustness. It minimizes the maximum training loss across all groups by strategically increasing regularization, ensuring the model doesn\u2019t exhibit bias towards any particular group.\nThese fairness algorithms are incorporated into segmentation methods, specifically SAMed and TransUNet, to assess their capability in enhancing fairness and reducing bias across diverse demographic groups during segmentation."
        },
        {
            "heading": "6.2 Training Setup",
            "text": "Datasets. As we introduce in Section 4, 8,000 SLO fundus images are used for training, and 2,000 SLO fundus images are used for evaluation, with the patient-level split. Apart from the pixel-wise annotation for disc and cup regions, each sample also includes six different sensitive attributes. In this paper, we select four sensitive attributes that obtain the largest group-wise discrepancy in practice, including Race, Gender, Language, and Ethnicity. Training and Implementation Details. For both SAMed and TransUNet, a combined loss function comprising both cross entropy and dice losses is employed as the training loss. The loss function can be defined as\nL = \u03bb1CE(S\u0302l, D(S)) + \u03bb2Dice(S\u0302l, D(S)). (6)\nHere, CE and Dice stand for the cross entropy loss and Dice loss, respectively. The loss weights \u03bb1 and \u03bb2 help alternate a balance between the two loss terms. In the initial stages of training, we leverage a warmup strategy to stabilize the model training with our HarvardFairSeg data. We use the AdamW optimizer with exponential learning rate decay. For the backbone of SAMed and TransUNet, we select the standard ViT-B architecture. We use a learning rate of 0.01, momentum of 0.9, and weight decay 1e-4 for TransUNet. For SAMed, we set the learning rate to 0.005, with momentum and weight decay set to 0.9 and 0.1,\nrespectively. The SAMed model is trained for a total of 130 epochs with an early stopping at the 70 epoch. The TransUNet is trained for 300 epochs without early stopping, following their original implementation. We use a batch size of 42 for training both models. When combining with the fairness algorithms, we use the same setup as aforementioned. For our proposed fair error-bound scaling, we set \u03b3 = 1.0 for all our experiments."
        },
        {
            "heading": "6.3 Segmentation & Fairness Evaluation",
            "text": "Race. Table 6 shows the segmentation performance with respect to race, particularly among Asian, Black, and White groups, suggesting that SAMed+ADV, SAMed+GroupDRO, and our method yield relatively comparable results. SAMed+ADV slightly outperforms others in terms of Dice scores among the White subgroup and the overall ES-Dice and ES-IoU. For the Rim, our proposed SAMed+FEBS achieves the best ES-Dice of 0.7529 and the best ES-IoU of 0.6451, which surpasses other methods based on SAMed. TransUNet-based methods achieve relatively worse results than SAMed-based approaches. Notably, our methods with TransUNet as the backbone can surpass other TransUNet-based approaches in terms of ES-Dice and ES-IoU. Gender. When gender serves as the sensitive attribute, the distinctions between methods become subtler, as shown in Table 3. Our method combined with the SAMed and TransUNet model consistently outperforms the baseline and its counterpart in terms of ES-Dice and ES-IoU on both Cup and Rim. This showcases the efficacy of our technique in handling gender disparities. Similar to race, TransUNet-based methods also perform worse than the SAMed-based approaches. Language. For results with language attribute in Table 8, SAMed+ADV achieves the best performance and fairness for the Cup and rim segmentation when compared with methods based on SAMed. However, the performance of our approaches achieves the best based on TransUNet in terms of ES-Dice and ES-IoU. The disparity between different language groups is the second largest when compared to that of gender and ethnicity. Ethnicity. When considering ethnicity as the sensitive attribute, our method combined with both two segmentation models surpasses the rest in terms of ES-Dice and ES-IoU scores. The details of results with ethnicity are shown in Table 9. The performance gaps between Hispanics and Non-Hispanics are larger than gender."
        },
        {
            "heading": "7 Conclusion",
            "text": "In this paper, we propose the first dataset to study fairness in medical segmentation. The proposed FairSeg benchmarks are equipped with many SOTA fairness algorithms using different segmentation backbones. Our innovative fair error-bound scaling technique introduces a new fairness dice loss for segmentation tasks. Furthermore, a new equity-scaled evaluation metric provides novel scoring functions for evaluating the fairness of segmentation between different demographic groups. We hope that our contributions not only stimulate further research in this new domain but also serve as a catalyst for the adoption of fairness considerations in medical AI applications universally."
        },
        {
            "heading": "2018, Held in Conjunction with MICCAI 2018, Granada, Spain, September 20, 2018,",
            "text": "Proceedings 4, pp. 3\u201311. Springer, 2018.\nYongshuo Zong, Yongxin Yang, and Timothy Hospedales. Medfair: Benchmarking fairness for medical imaging. arXiv preprint arXiv:2210.01725, 2022."
        },
        {
            "heading": "A Appendix",
            "text": "Equity-Scaled Metric Using Standard Deviation. A modification to the original equity-scaled metric involves calculating the standard deviation Stdev of the segmentation metric for various demographic groups. Let I \u2208 {Dice, IoU, . . .} represent a segmentation metric. Conventional segmentation metrics, like Dice and IoU, can be expressed as M({(z\u2032, y)}), where they assess the overlap between the predicted segmentation z\u2032 and the ground truth y. Let\u2019s denote the set of all demographic groups as A. Given this, the Equity-Scaled Segmentation Performance with standard deviation (ESSPStdev) metric for segmentation, ESSP-Stdev, is defined as:\nESSP-Stdev = I({(z \u2032, y)})\n1 + Stdev (7)\nThe denominator in Equation (7) naturally penalizes variations in the segmentation metric across demographics. As Stdev approaches zero, indicating uniform performance across groups, ESSP converges to I. Conversely, as the variability (Stdev) increases, ESSP will diminish, thereby reflecting a penalty for demographic disparity. A potential limitation of this metric is that it may yield only marginal differences between Equity-Scaled performance and the overall segmentation performance. This subtle distinction could pose a challenge in discerning the effectiveness of various de-biasing approaches in enhancing algorithmic fairness. Nonetheless, for reference purposes, we include results derived from such metrics in this appendix.\nExpansion of Evaluation Metrics. To provide a more thorough assessment of segmentation accuracy, in Table. 10, we provide the segmentation performances on our Harvard-FairSeg dataset with race as the sensitive attribute in terms of Hausdorff Distance (HD95), Average Surface Distance (ASD), and Normalized Surface Distance (NSD)."
        }
    ],
    "title": "FairSeg: A Large-Scale Medical Image Segmentation Dataset for Fairness Learning Using Segment Anything Model with Fair Error-Bound Scaling",
    "year": 2024
}